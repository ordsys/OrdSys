define("wap/trade/cart/api/cartapi",["require","zenjs/util/local_storage","zenjs/util/args"],function(t){"use strict";var e=t("zenjs/util/local_storage"),n=t("zenjs/util/args"),i="/v2/trade/cart/goods.json",o="/v2/trade/cart/deleteBatchList.json?kdt_id="+window._global.kdt_id,s=["youzanmars"],a=window._global.platform,r=s.indexOf(a)>-1,l="youzanmars"===a,c=n.get("source"),d=n.get("cart_type");"all"!==d&&("all"===d||"youzanmars"!==a&&"yzapp"!==c)||(i=n.add(i,{type:"all"}));var u=function(t){var e=[],i={activity_alias:[],activity_id:"",activity_type:"",order_from:"cart"};_.each(t,function(t){e.push({goods_id:t.goods_id,sku_id:t.sku_id,price:t.pay_price||0,num:t.num,id:t.sku_id,sku_code:t.code||"",activity_alias:t.activity_alias,item_message:t.messages,dc_ps:t.dc_ps||"",update_time:t.update_time||"",create_time:t.create_time||""}),i.activity_alias.push({goods_id:t.goods_id,sku_id:t.sku_id,activity_alias:t.activity_alias})}),i.kdt_id=t[0].kdt_id;window._global;i.store_id=((t||[])[0]||{}).store_id||0;var o=n.get("from");return o&&o.length>0&&(i.from=o),{common:JSON.stringify(i),isMultiShopChecked:0,goodsList:JSON.stringify(e)}},p={};try{p=JSON.parse(e.getItem("cartLastGoods"))}finally{p=p||{}}var h={};return{isChecked:function(t,e,n){var i=t+"-"+e+"-"+n;return h[i]&&1===h[i]},setCheckStatus:function(t,n,i,o){var s=t+"-"+n+"-"+i;h[s]=o?1:2,e.setItem("cartLastGoods",JSON.stringify(h))},setNum:function(t,e,i,o,s){var a=n.add("/v2/trade/cart/goods.json",{kdt_id:t,sku_id:e,goods_id:i,store_id:o||0}),r=new $.Deferred;return $._ajax({url:a,type:"PATCH",dataType:"json",data:{num:s},success:function(t){0==t.code?r.resolve(t.data):r.reject(t.msg)},error:function(){r.reject("服务不可访问")}}),r},getCart:function(){var t=new $.Deferred;return $._ajax({url:i,type:"GET",dataType:"json",timeout:1e4,success:function(n){var i=n.data||[];_.each(i,function(t){_.each(t.goods_list,function(e){var n=t.kdt_id+"-"+e.goods_id+"-"+e.sku_id;p[n]&&1!==p[n]?h[n]=2:h[n]=1})}),e.setItem("cartLastGoods",JSON.stringify(h)),t.resolve(i)},error:function(e,n,i){t.reject("数据加载失败")}}),t},goToPay:function(t){var e=new $.Deferred;return $._ajax({url:"/v2/trade/common/cache.json",type:"POST",dataType:"json",data:u(t),success:function(t){0==t.code?e.resolve(t.data):e.reject(t.msg)},error:function(){e.reject("服务不可访问")}}),e},deleteGoods:function(t,e,i,o){var s=new $.Deferred;return $._ajax({url:n.add("/v2/trade/cart/goods.json",{kdt_id:t,sku_id:e,goods_id:i,store_id:o||0}),dataType:"json",type:"DELETE",success:function(t){0==t.code?s.resolve(t):s.reject(t.msg)},error:function(){s.reject("删除失败")}}),s},deleteBatch:function(t){var e=new $.Deferred,n=[];return _.each(t,function(t){n.push({kdt_id:t.kdt_id,sku_id:t.sku_id,goods_id:t.goods_id})}),$._ajax({url:o,type:"POST",dataType:"json",data:{ids:n},success:function(t){0==t.code?e.resolve(t):e.reject(t.msg)},error:function(){e.reject("删除失败")}}),e},goodsLink:_global.wap_url.wap+"/showcase/goods",isAppCart:r,isMaijiaBan:l}}),define("text!wap/trade/cart/templates/app.html",[],function(){return'<div>\n    <template v-if="!loaded">\n        <div class="loading-more">\n            <span></span>\n        </div>\n    </template>\n\n    <template v-if="loaded && shopListHasValidGoods.length == 0 && invalidGoodsList.length == 0">\n        <div class="empty-list " style="padding-top:60px;">\n            <div class="empty-list-header">\n                <h4>购物车快饿瘪了 T.T</h4>\n                <span>快给我挑点宝贝</span>\n            </div>\n            <div class="empty-list-content" v-if="emptyCartLink">\n                <a :href="emptyCartLink" class="js-go-home home-page tag tag-big tag-orange">去逛逛</a>\n            </div>\n        </div>\n    </template>\n\n    <template v-if="loaded && shopListHasValidGoods.length > 0">\n        <vm-login v-if="needLogin && !isLogin && canShowLonginTips" :isAppCart="isAppCart" @okClicked="tipsOkClicked">\n        </vm-login>\n\n        <div class="js-shop-list shop-list">\n            <vm-shop v-for="(shop,index) in shopListHasValidGoods" :shop="shop" :shopSate="shopsState[shop.kdt_id]" :key="shop.kdt_id"\n                :hasEditing="hasEditing" ></vm-shop>\n        </div>\n    </template>\n\n\n    <template v-if="loaded && invalidGoodsList.length > 0">\n        <div class="js-invalid-goods shop-list">\n            <p class="block invalid-list-title">\n                以下商品无法一起购买\n            </p>\n            <div class="block block-list-cart block-order border-top-0">\n                <ul class="block border-0 invalid-list js-invalid-list">\n                    <template v-for="(goods,index) in invalidGoodsList">\n                        <li class="block-item block-item-cart error">\n                            <vm-goods :goods="goods" :index="index"  :invalid="true"></vm-goods>\n                        </li>\n                    </template>\n                </ul>\n                <div class="center clear-block">\n                    <button class="btn clear-btn js-clear" @click="clearInvalidAllGoods">清空失效商品</button>\n                </div>\n            </div>\n        </div>\n    </template>\n\n    <template v-if="loaded && shopListHasValidGoods.length > 0">\n\n        <div class="js-bottom-opts bottom-fix" style="padding:0;">\n            <template v-if="shopListHasValidGoods.length > 1">\n                <div class="go-shop-tip js-go-shop-tip c-orange font-size-12">\n                    您需要分开结算每个店铺的商品哦~\n                </div>\n            </template>\n\n            <div class="bottom-cart clear-fix">\n                <div class="select-all" @click="allCheckClick">\n                    <span class="check" :class="{checked:hasEditing?allEditingShopHasAllDeleteMark:allHasChooseMark}">\n                </span> 全选\n                </div>\n                <template v-if="!loopResult.hasEditing">\n                    <div class="total-price" :class="{\'c-gray-dark\':loopResult.chooseCnt<=0}">\n                        合计：¥<span :style="{color:(loopResult.chooseCnt > 0 ? \'#f60\' : \'#999\')}" class="js-total-price">{{loopResult.totalPrice/100}}</span>\n                        <p class="c-gray-dark">不含运费</p>\n                    </div>\n                    <button href="javascript:;" class="js-go-pay btn btn-orange-dark font-size-14" :disabled="loopResult.chooseCnt<=0" @click="goPayClick">\n                        结算\n                        <template v-if="loopResult.chooseCnt>0">\n                            ({{loopResult.chooseCnt}})\n                        </template>\n                    </button>\n                </template>\n                <template v-if="loopResult.hasEditing">\n                    <button href="javascript:;" class="j-delete-goods btn font-size-14 btn-red" :disabled="loopResult.hasDeleteMarkGoodsList.length<=0"\n                        @click="deleteAllSelectedGoods">删除\n                    </button>\n                </template>\n            </div>\n        </div>\n\n    </template>\n</div>\n'}),define("text!wap/trade/cart/templates/login.html",[],function(){return'<div class="js-login-tip block login-tip font-size-12">\n\n    <template v-if="!isAppCart">\n        <i class="js-close-login close-btn" @click="onCloseLoginClick"></i>\n        绑定手机号可保存购物车中所有商品\n        <a href="javascript:void(0)"  class="js-login-btn btn login-btn" @click="onLoginBtnClick" >立即绑定</a>\n    </template>\n\n    <template v-if="isAppCart">\n        登录后你可以保存购物车中的所有商品\n        <a href="javascript:void(0)" class="js-login-btn btn login-btn" @click="onLoginBtnClick" style="padding: 3px 10px;">登录</a>\n    </template>\n</div>'}),define("zenjs/util/number",[],function(){return{makeRandomString:function(t){var e="",n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";t=t||10;for(var i=0;i<t;i++)e+=n.charAt(Math.floor(Math.random()*n.length));return e}}}),define("bower_components/pop/pop",["require","zenjs/events","zenjs/util/number"],function(t){var e=function(){},n=t("zenjs/events"),i=t("zenjs/util/number");return window.zenjs=window.zenjs||{},n.extend({init:function(t){this._window=$(window);var n=i.makeRandomString();$("body").append('<div id="'+n+'"                 style="display:none; height: 100%;                 position: fixed; top: 0; left: 0; right: 0;                background-color: rgba(0, 0, 0, '+(t.transparent||".7")+');z-index:1000;opacity:0;transition: opacity ease 0.2s;"></div>'),this.nBg=$("#"+n),this.nBg.on("click",$.proxy(function(){this.isCanNotHide||this.hide()},this));var o=i.makeRandomString();$("body").append('<div id="'+o+'" class="'+(t.className||"")+'" style="overflow:hidden;visibility: hidden;"></div>'),this.nPopContainer=$("#"+o),this.nPopContainer.hide(),this.nPopContainer.css({opacity:0,position:"absolute","z-index":1e3}),t.contentViewClass&&(this.contentViewClass=t.contentViewClass,this.contentViewOptions=$.extend({el:this.nPopContainer},t.contentViewOptions||{}),this.contentView=new this.contentViewClass($.extend({onHide:$.proxy(this.hide,this)},this.contentViewOptions)),this.contentView.onHide=$.proxy(this.hide,this)),this.animationTime=t.animationTime||300,this.isCanNotHide=t.isCanNotHide,this.doNotRemoveOnHide=t.doNotRemoveOnHide||!1,this.onShow=t.onShow||e,this.onHide=t.onHide||e,this.onFinishHide=t.onFinishHide||e,this.html=t.html},render:function(t){return this.renderOptions=t||{},this.contentViewClass?this.contentView.render(this.renderOptions):this.html&&this.nPopContainer.html(this.html),this},show:function(){return this.nBg.show().css({opacity:"1","transition-property":"none"}),this.nPopContainer.show(),this.trigger("pop:show:before"),setTimeout($.proxy(function(){this.trigger("pop:show:after"),this.nPopContainer.show().css("visibility","visible"),this._doShow&&this._doShow(),this.onShow()},this),200),this},hide:function(t){t=t||{};var e=t.doNotRemove||this.doNotRemoveOnHide||!1;this._doHide&&this._doHide(),this.trigger("pop:hide:before"),setTimeout($.proxy(function(){this.nBg.css({opacity:0,"transition-property":"opacity"}),this.trigger("pop:hide:after"),setTimeout($.proxy(function(){this.nBg.hide(),this.nPopContainer.hide(),e||this.destroy()},this),200)},this),this.animationTime),this.onHide()},destroy:function(){return this.nPopContainer.remove(),this.nBg.remove(),this.contentView&&this.contentView.remove(),this}})}),define("bower_components/pop/pop_forbid_scroll",["require","./pop"],function(t){return window.zenjs=window.zenjs||{},t("./pop").extend({init:function(t){this._super(t),t.doNotForbidScroll||(this.on("pop:show:before",$.proxy(this.onBeforePopShow,this)),this.on("pop:show:after",$.proxy(this.onAfterPopShow,this)),this.on("pop:hide:after",$.proxy(this.onAfterPopHide,this)))},onBeforePopShow:function(){this.top=this._window.scrollTop()},onAfterPopShow:function(){this._window.scrollTop(0),this.startShow()},onAfterPopHide:function(){var t,e=function(n){if(t!==this._window.scrollTop()&&n>0)return this._window.scrollTop(t),void setTimeout($.proxy(e,this,n-1));setTimeout($.proxy(this.onFinishHide,this),50)};return function(){this.startHide(),t=this.top,this._window.scrollTop(t),$.proxy(e,this)(2),setTimeout($.proxy(function(){window.zenjs.popList.length<1&&$("html").css("position",this.htmlPosition)},this),200)}}(),startShow:function(){var t=window.zenjs.popList;if(t||(t=window.zenjs.popList=[]),0===t.length){var e=$("body"),n=$("html");this.htmlPosition=n.css("position"),n.css("position","relative"),this.bodyCss=(e.prop("style")||{}).cssText,this.htmlCss=(n.prop("style")||{}).cssText,$("body,html").css({overflow:"hidden",height:this._window.height(),"padding-bottom":0,"margin-bottom":0})}t.indexOf(this)<0&&t.push(this)},startHide:function(){var t=window.zenjs.popList,e=t.indexOf(this);e>-1&&t.splice(e,1),t.length<1&&($("html").attr("style",this.htmlCss||""),$("body").attr("style",this.bodyCss||""))}})}),define("bower_components/pop/popout",["require","./pop_forbid_scroll"],function(t){return t("./pop_forbid_scroll").extend({init:function(t){t=t||{},this._super(t),this.css=$.extend({transition:"opacity ease "+this.animationTime+"ms",top:"50%",left:"50%","-webkit-transform":"translate3d(-50%, -50%, 0)",transform:"translateY(-50%, -50%, 0)"},t.css||{}),this.nPopContainer.css(this.css)},_doShow:function(){$(".js-popout-close").click($.proxy(function(t){this.hide()},this)),this.nPopContainer.css("opacity",1),this.nPopContainer.show()},_doHide:function(t){this.nPopContainer.css({opacity:0})}})}),define("bower_components/pop/popout_box",["require","./popout"],function(t){var e=function(){};return t("./popout").extend({init:function(t){this._super(t),this._onOKClicked=t.onOKClicked||e,this._onCancelClicked=t.onCancelClicked||e,this.preventHideOnOkClicked=t.preventHideOnOkClicked||!1,this.width=t.width,this.setEventListener()},setEventListener:function(){this.nPopContainer.on("click",".js-ok",$.proxy(this.onOKClicked,this)),this.nPopContainer.on("click",".js-cancel",$.proxy(this.onCancelClicked,this))},_doShow:function(){this.boxCss={"border-radius":"4px",background:"white",width:this.width||"270px",padding:"15px"},this.nPopContainer.css(this.boxCss).addClass("popout-box"),this._super()},_doHide:function(t){this._super()},onOKClicked:function(t){this._onOKClicked(t),!this.preventHideOnOkClicked&&this.hide()},onCancelClicked:function(t){this._onCancelClicked(t),this.hide()}})}),define("bower_components/aes/aes",["require","exports","module"],function(t,e,n){var i=i||function(t,e){var n={},i=n.lib={},o=function(){},s=i.Base={extend:function(t){o.prototype=this;var e=new o;return t&&e.mixIn(t),e.hasOwnProperty("init")||(e.init=function(){e.$super.init.apply(this,arguments)}),e.init.prototype=e,e.$super=this,e},create:function(){var t=this.extend();return t.init.apply(t,arguments),t},init:function(){},mixIn:function(t){for(var e in t)t.hasOwnProperty(e)&&(this[e]=t[e]);t.hasOwnProperty("toString")&&(this.toString=t.toString)},clone:function(){return this.init.prototype.extend(this)}},a=i.WordArray=s.extend({init:function(t,e){t=this.words=t||[],this.sigBytes=void 0!=e?e:4*t.length},toString:function(t){return(t||l).stringify(this)},concat:function(t){var e=this.words,n=t.words,i=this.sigBytes;if(t=t.sigBytes,this.clamp(),i%4)for(var o=0;o<t;o++)e[i+o>>>2]|=(n[o>>>2]>>>24-o%4*8&255)<<24-(i+o)%4*8;else if(65535<n.length)for(o=0;o<t;o+=4)e[i+o>>>2]=n[o>>>2];else e.push.apply(e,n);return this.sigBytes+=t,this},clamp:function(){var e=this.words,n=this.sigBytes;e[n>>>2]&=4294967295<<32-n%4*8,e.length=t.ceil(n/4)},clone:function(){var t=s.clone.call(this);return t.words=this.words.slice(0),t},random:function(e){for(var n=[],i=0;i<e;i+=4)n.push(4294967296*t.random()|0);return new a.init(n,e)}}),r=n.enc={},l=r.Hex={stringify:function(t){var e=t.words;t=t.sigBytes;for(var n=[],i=0;i<t;i++){var o=e[i>>>2]>>>24-i%4*8&255;n.push((o>>>4).toString(16)),n.push((15&o).toString(16))}return n.join("")},parse:function(t){for(var e=t.length,n=[],i=0;i<e;i+=2)n[i>>>3]|=parseInt(t.substr(i,2),16)<<24-i%8*4;return new a.init(n,e/2)}},c=r.Latin1={stringify:function(t){var e=t.words;t=t.sigBytes;for(var n=[],i=0;i<t;i++)n.push(String.fromCharCode(e[i>>>2]>>>24-i%4*8&255));return n.join("")},parse:function(t){for(var e=t.length,n=[],i=0;i<e;i++)n[i>>>2]|=(255&t.charCodeAt(i))<<24-i%4*8;return new a.init(n,e)}},d=r.Utf8={stringify:function(t){try{return decodeURIComponent(escape(c.stringify(t)))}catch(t){throw Error("Malformed UTF-8 data")}},parse:function(t){return c.parse(unescape(encodeURIComponent(t)))}},u=i.BufferedBlockAlgorithm=s.extend({reset:function(){this._data=new a.init,this._nDataBytes=0},_append:function(t){"string"==typeof t&&(t=d.parse(t)),this._data.concat(t),this._nDataBytes+=t.sigBytes},_process:function(e){var n=this._data,i=n.words,o=n.sigBytes,s=this.blockSize,r=o/(4*s),r=e?t.ceil(r):t.max((0|r)-this._minBufferSize,0);if(e=r*s,o=t.min(4*e,o),e){for(var l=0;l<e;l+=s)this._doProcessBlock(i,l);l=i.splice(0,e),n.sigBytes-=o}return new a.init(l,o)},clone:function(){var t=s.clone.call(this);return t._data=this._data.clone(),t},_minBufferSize:0});i.Hasher=u.extend({cfg:s.extend(),init:function(t){this.cfg=this.cfg.extend(t),this.reset()},reset:function(){u.reset.call(this),this._doReset()},update:function(t){return this._append(t),this._process(),this},finalize:function(t){return t&&this._append(t),this._doFinalize()},blockSize:16,_createHelper:function(t){return function(e,n){return new t.init(n).finalize(e)}},_createHmacHelper:function(t){return function(e,n){return new p.HMAC.init(t,n).finalize(e)}}});var p=n.algo={};return n}(Math);!function(){var t=i,e=t.lib.WordArray;t.enc.Base64={stringify:function(t){var e=t.words,n=t.sigBytes,i=this._map;t.clamp(),t=[];for(var o=0;o<n;o+=3)for(var s=(e[o>>>2]>>>24-o%4*8&255)<<16|(e[o+1>>>2]>>>24-(o+1)%4*8&255)<<8|e[o+2>>>2]>>>24-(o+2)%4*8&255,a=0;4>a&&o+.75*a<n;a++)t.push(i.charAt(s>>>6*(3-a)&63));if(e=i.charAt(64))for(;t.length%4;)t.push(e);return t.join("")},parse:function(t){var n=t.length,i=this._map,o=i.charAt(64);o&&-1!=(o=t.indexOf(o))&&(n=o);for(var o=[],s=0,a=0;a<n;a++)if(a%4){var r=i.indexOf(t.charAt(a-1))<<a%4*2,l=i.indexOf(t.charAt(a))>>>6-a%4*2;o[s>>>2]|=(r|l)<<24-s%4*8,s++}return e.create(o,s)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="}}(),function(t){function e(t,e,n,i,o,s,a){return((t=t+(e&n|~e&i)+o+a)<<s|t>>>32-s)+e}function n(t,e,n,i,o,s,a){return((t=t+(e&i|n&~i)+o+a)<<s|t>>>32-s)+e}function o(t,e,n,i,o,s,a){return((t=t+(e^n^i)+o+a)<<s|t>>>32-s)+e}function s(t,e,n,i,o,s,a){return((t=t+(n^(e|~i))+o+a)<<s|t>>>32-s)+e}for(var a=i,r=a.lib,l=r.WordArray,c=r.Hasher,r=a.algo,d=[],u=0;64>u;u++)d[u]=4294967296*t.abs(t.sin(u+1))|0;r=r.MD5=c.extend({_doReset:function(){this._hash=new l.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(t,i){for(var a=0;16>a;a++){var r=i+a,l=t[r];t[r]=16711935&(l<<8|l>>>24)|4278255360&(l<<24|l>>>8)}var a=this._hash.words,r=t[i+0],l=t[i+1],c=t[i+2],u=t[i+3],p=t[i+4],h=t[i+5],f=t[i+6],m=t[i+7],g=t[i+8],v=t[i+9],w=t[i+10],_=t[i+11],y=t[i+12],b=t[i+13],k=t[i+14],x=t[i+15],C=a[0],j=a[1],S=a[2],T=a[3],C=e(C,j,S,T,r,7,d[0]),T=e(T,C,j,S,l,12,d[1]),S=e(S,T,C,j,c,17,d[2]),j=e(j,S,T,C,u,22,d[3]),C=e(C,j,S,T,p,7,d[4]),T=e(T,C,j,S,h,12,d[5]),S=e(S,T,C,j,f,17,d[6]),j=e(j,S,T,C,m,22,d[7]),C=e(C,j,S,T,g,7,d[8]),T=e(T,C,j,S,v,12,d[9]),S=e(S,T,C,j,w,17,d[10]),j=e(j,S,T,C,_,22,d[11]),C=e(C,j,S,T,y,7,d[12]),T=e(T,C,j,S,b,12,d[13]),S=e(S,T,C,j,k,17,d[14]),j=e(j,S,T,C,x,22,d[15]),C=n(C,j,S,T,l,5,d[16]),T=n(T,C,j,S,f,9,d[17]),S=n(S,T,C,j,_,14,d[18]),j=n(j,S,T,C,r,20,d[19]),C=n(C,j,S,T,h,5,d[20]),T=n(T,C,j,S,w,9,d[21]),S=n(S,T,C,j,x,14,d[22]),j=n(j,S,T,C,p,20,d[23]),C=n(C,j,S,T,v,5,d[24]),T=n(T,C,j,S,k,9,d[25]),S=n(S,T,C,j,u,14,d[26]),j=n(j,S,T,C,g,20,d[27]),C=n(C,j,S,T,b,5,d[28]),T=n(T,C,j,S,c,9,d[29]),S=n(S,T,C,j,m,14,d[30]),j=n(j,S,T,C,y,20,d[31]),C=o(C,j,S,T,h,4,d[32]),T=o(T,C,j,S,g,11,d[33]),S=o(S,T,C,j,_,16,d[34]),j=o(j,S,T,C,k,23,d[35]),C=o(C,j,S,T,l,4,d[36]),T=o(T,C,j,S,p,11,d[37]),S=o(S,T,C,j,m,16,d[38]),j=o(j,S,T,C,w,23,d[39]),C=o(C,j,S,T,b,4,d[40]),T=o(T,C,j,S,r,11,d[41]),S=o(S,T,C,j,u,16,d[42]),j=o(j,S,T,C,f,23,d[43]),C=o(C,j,S,T,v,4,d[44]),T=o(T,C,j,S,y,11,d[45]),S=o(S,T,C,j,x,16,d[46]),j=o(j,S,T,C,c,23,d[47]),C=s(C,j,S,T,r,6,d[48]),T=s(T,C,j,S,m,10,d[49]),S=s(S,T,C,j,k,15,d[50]),j=s(j,S,T,C,h,21,d[51]),C=s(C,j,S,T,y,6,d[52]),T=s(T,C,j,S,u,10,d[53]),S=s(S,T,C,j,w,15,d[54]),j=s(j,S,T,C,l,21,d[55]),C=s(C,j,S,T,g,6,d[56]),T=s(T,C,j,S,x,10,d[57]),S=s(S,T,C,j,f,15,d[58]),j=s(j,S,T,C,b,21,d[59]),C=s(C,j,S,T,p,6,d[60]),T=s(T,C,j,S,_,10,d[61]),S=s(S,T,C,j,c,15,d[62]),j=s(j,S,T,C,v,21,d[63]);a[0]=a[0]+C|0,a[1]=a[1]+j|0,a[2]=a[2]+S|0,a[3]=a[3]+T|0},_doFinalize:function(){var e=this._data,n=e.words,i=8*this._nDataBytes,o=8*e.sigBytes;n[o>>>5]|=128<<24-o%32;var s=t.floor(i/4294967296);for(n[15+(o+64>>>9<<4)]=16711935&(s<<8|s>>>24)|4278255360&(s<<24|s>>>8),n[14+(o+64>>>9<<4)]=16711935&(i<<8|i>>>24)|4278255360&(i<<24|i>>>8),e.sigBytes=4*(n.length+1),this._process(),e=this._hash,n=e.words,i=0;4>i;i++)o=n[i],n[i]=16711935&(o<<8|o>>>24)|4278255360&(o<<24|o>>>8);return e},clone:function(){var t=c.clone.call(this);return t._hash=this._hash.clone(),t}}),a.MD5=c._createHelper(r),a.HmacMD5=c._createHmacHelper(r)}(Math),function(){var t=i,e=t.lib,n=e.Base,o=e.WordArray,e=t.algo,s=e.EvpKDF=n.extend({cfg:n.extend({keySize:4,hasher:e.MD5,iterations:1}),init:function(t){this.cfg=this.cfg.extend(t)},compute:function(t,e){for(var n=this.cfg,i=n.hasher.create(),s=o.create(),a=s.words,r=n.keySize,n=n.iterations;a.length<r;){l&&i.update(l);var l=i.update(t).finalize(e);i.reset();for(var c=1;c<n;c++)l=i.finalize(l),i.reset();s.concat(l)}return s.sigBytes=4*r,s}});t.EvpKDF=function(t,e,n){return s.create(n).compute(t,e)}}(),i.lib.Cipher||function(t){var e=i,n=e.lib,o=n.Base,s=n.WordArray,a=n.BufferedBlockAlgorithm,r=e.enc.Base64,l=e.algo.EvpKDF,c=n.Cipher=a.extend({cfg:o.extend(),createEncryptor:function(t,e){return this.create(this._ENC_XFORM_MODE,t,e)},createDecryptor:function(t,e){return this.create(this._DEC_XFORM_MODE,t,e)},init:function(t,e,n){this.cfg=this.cfg.extend(n),this._xformMode=t,this._key=e,this.reset()},reset:function(){a.reset.call(this),this._doReset()},process:function(t){return this._append(t),this._process()},finalize:function(t){return t&&this._append(t),this._doFinalize()},keySize:4,ivSize:4,_ENC_XFORM_MODE:1,_DEC_XFORM_MODE:2,_createHelper:function(t){return{encrypt:function(e,n,i){return("string"==typeof n?m:f).encrypt(t,e,n,i)},decrypt:function(e,n,i){return("string"==typeof n?m:f).decrypt(t,e,n,i)}}}});n.StreamCipher=c.extend({_doFinalize:function(){return this._process(!0)},blockSize:1});var d=e.mode={},u=function(t,e,n){var i=this._iv;i?this._iv=void 0:i=this._prevBlock;for(var o=0;o<n;o++)t[e+o]^=i[o]},p=(n.BlockCipherMode=o.extend({createEncryptor:function(t,e){return this.Encryptor.create(t,e)},createDecryptor:function(t,e){return this.Decryptor.create(t,e)},init:function(t,e){this._cipher=t,this._iv=e}})).extend();p.Encryptor=p.extend({processBlock:function(t,e){var n=this._cipher,i=n.blockSize;u.call(this,t,e,i),n.encryptBlock(t,e),this._prevBlock=t.slice(e,e+i)}}),p.Decryptor=p.extend({processBlock:function(t,e){var n=this._cipher,i=n.blockSize,o=t.slice(e,e+i);n.decryptBlock(t,e),u.call(this,t,e,i),this._prevBlock=o}}),d=d.CBC=p,p=(e.pad={}).Pkcs7={pad:function(t,e){for(var n=4*e,n=n-t.sigBytes%n,i=n<<24|n<<16|n<<8|n,o=[],a=0;a<n;a+=4)o.push(i);n=s.create(o,n),t.concat(n)},unpad:function(t){t.sigBytes-=255&t.words[t.sigBytes-1>>>2]}},n.BlockCipher=c.extend({cfg:c.cfg.extend({mode:d,padding:p}),reset:function(){c.reset.call(this);var t=this.cfg,e=t.iv,t=t.mode;if(this._xformMode==this._ENC_XFORM_MODE)var n=t.createEncryptor;else n=t.createDecryptor,this._minBufferSize=1;this._mode=n.call(t,this,e&&e.words)},_doProcessBlock:function(t,e){this._mode.processBlock(t,e)},_doFinalize:function(){var t=this.cfg.padding;if(this._xformMode==this._ENC_XFORM_MODE){t.pad(this._data,this.blockSize);var e=this._process(!0)}else e=this._process(!0),t.unpad(e);return e},blockSize:4});var h=n.CipherParams=o.extend({init:function(t){this.mixIn(t)},toString:function(t){return(t||this.formatter).stringify(this)}}),d=(e.format={}).OpenSSL={stringify:function(t){var e=t.ciphertext;return t=t.salt,(t?s.create([1398893684,1701076831]).concat(t).concat(e):e).toString(r)},parse:function(t){t=r.parse(t);var e=t.words;if(1398893684==e[0]&&1701076831==e[1]){var n=s.create(e.slice(2,4));e.splice(0,4),t.sigBytes-=16}return h.create({ciphertext:t,salt:n})}},f=n.SerializableCipher=o.extend({cfg:o.extend({format:d}),encrypt:function(t,e,n,i){i=this.cfg.extend(i);var o=t.createEncryptor(n,i);return e=o.finalize(e),o=o.cfg,h.create({ciphertext:e,key:n,iv:o.iv,algorithm:t,mode:o.mode,padding:o.padding,blockSize:t.blockSize,formatter:i.format})},decrypt:function(t,e,n,i){return i=this.cfg.extend(i),e=this._parse(e,i.format),t.createDecryptor(n,i).finalize(e.ciphertext)},_parse:function(t,e){return"string"==typeof t?e.parse(t,this):t}}),e=(e.kdf={}).OpenSSL={execute:function(t,e,n,i){return i||(i=s.random(8)),t=l.create({keySize:e+n}).compute(t,i),n=s.create(t.words.slice(e),4*n),t.sigBytes=4*e,h.create({key:t,iv:n,salt:i})}},m=n.PasswordBasedCipher=f.extend({cfg:f.cfg.extend({kdf:e}),encrypt:function(t,e,n,i){return i=this.cfg.extend(i),n=i.kdf.execute(n,t.keySize,t.ivSize),i.iv=n.iv,t=f.encrypt.call(this,t,e,n.key,i),t.mixIn(n),t},decrypt:function(t,e,n,i){return i=this.cfg.extend(i),e=this._parse(e,i.format),n=i.kdf.execute(n,t.keySize,t.ivSize,e.salt),i.iv=n.iv,f.decrypt.call(this,t,e,n.key,i)}})}(),function(){for(var t=i,e=t.lib.BlockCipher,n=t.algo,o=[],s=[],a=[],r=[],l=[],c=[],d=[],u=[],p=[],h=[],f=[],m=0;256>m;m++)f[m]=128>m?m<<1:m<<1^283;for(var g=0,v=0,m=0;256>m;m++){var w=v^v<<1^v<<2^v<<3^v<<4,w=w>>>8^255&w^99;o[g]=w,s[w]=g;var _=f[g],y=f[_],b=f[y],k=257*f[w]^16843008*w;a[g]=k<<24|k>>>8,r[g]=k<<16|k>>>16,l[g]=k<<8|k>>>24,c[g]=k,k=16843009*b^65537*y^257*_^16843008*g,d[w]=k<<24|k>>>8,u[w]=k<<16|k>>>16,p[w]=k<<8|k>>>24,h[w]=k,g?(g=_^f[f[f[b^_]]],v^=f[f[v]]):g=v=1}var x=[0,1,2,4,8,16,32,64,128,27,54],n=n.AES=e.extend({_doReset:function(){for(var t=this._key,e=t.words,n=t.sigBytes/4,t=4*((this._nRounds=n+6)+1),i=this._keySchedule=[],s=0;s<t;s++)if(s<n)i[s]=e[s];else{var a=i[s-1];s%n?6<n&&4==s%n&&(a=o[a>>>24]<<24|o[a>>>16&255]<<16|o[a>>>8&255]<<8|o[255&a]):(a=a<<8|a>>>24,a=o[a>>>24]<<24|o[a>>>16&255]<<16|o[a>>>8&255]<<8|o[255&a],a^=x[s/n|0]<<24),i[s]=i[s-n]^a}for(e=this._invKeySchedule=[],n=0;n<t;n++)s=t-n,a=n%4?i[s]:i[s-4],e[n]=4>n||4>=s?a:d[o[a>>>24]]^u[o[a>>>16&255]]^p[o[a>>>8&255]]^h[o[255&a]]},encryptBlock:function(t,e){this._doCryptBlock(t,e,this._keySchedule,a,r,l,c,o)},decryptBlock:function(t,e){var n=t[e+1];t[e+1]=t[e+3],t[e+3]=n,this._doCryptBlock(t,e,this._invKeySchedule,d,u,p,h,s),n=t[e+1],t[e+1]=t[e+3],t[e+3]=n},_doCryptBlock:function(t,e,n,i,o,s,a,r){for(var l=this._nRounds,c=t[e]^n[0],d=t[e+1]^n[1],u=t[e+2]^n[2],p=t[e+3]^n[3],h=4,f=1;f<l;f++)var m=i[c>>>24]^o[d>>>16&255]^s[u>>>8&255]^a[255&p]^n[h++],g=i[d>>>24]^o[u>>>16&255]^s[p>>>8&255]^a[255&c]^n[h++],v=i[u>>>24]^o[p>>>16&255]^s[c>>>8&255]^a[255&d]^n[h++],p=i[p>>>24]^o[c>>>16&255]^s[d>>>8&255]^a[255&u]^n[h++],c=m,d=g,u=v;m=(r[c>>>24]<<24|r[d>>>16&255]<<16|r[u>>>8&255]<<8|r[255&p])^n[h++],g=(r[d>>>24]<<24|r[u>>>16&255]<<16|r[p>>>8&255]<<8|r[255&c])^n[h++],v=(r[u>>>24]<<24|r[p>>>16&255]<<16|r[c>>>8&255]<<8|r[255&d])^n[h++],p=(r[p>>>24]<<24|r[c>>>16&255]<<16|r[d>>>8&255]<<8|r[255&u])^n[h++],t[e]=m,t[e+1]=g,t[e+2]=v,t[e+3]=p},keySize:8});t.AES=e._createHelper(n)}(),i.pad.Iso10126={pad:function(t,e){var n=4*e,n=n-t.sigBytes%n;t.concat(i.lib.WordArray.random(n-1)).concat(i.lib.WordArray.create([n<<24],1))},unpad:function(t){t.sigBytes-=255&t.words[t.sigBytes-1>>>2]}},n.exports=i}),define("bower_components/aes/main",["require","./aes"],function(t){var e=t("./aes"),n=e.enc.Utf8.parse("youzan.com.aesiv"),i=e.enc.Utf8.parse("youzan.com._key_");return{encrypt:function(t){return t=e.enc.Utf8.parse(t),e.AES.encrypt(t,i,{mode:e.mode.CBC,padding:e.pad.Iso10126,iv:n}).toString()}}}),define("text!bower_components/login/templates/init.html",[],function(){return'<form class="js-login-form popout-login" method="GET" action="">\n    <div class="header c-green center">\n        <h2>请填写您的手机号码</h2>\n    </div>\n    <fieldset class="wrapper-form font-size-14">\n        <div class="form-item">\n            <label for="phone">手机号</label>\n            <input id="phone" name="phone" type="tel" maxlength="11" autocomplete="off" placeholder="" value="<%= phone %>">\n        </div>\n        <div class="js-help-info font-size-12 error c-orange"></div>\n    </fieldset>\n    <div class="action-container">\n        <input type="submit" class="js-confirm btn btn-green btn-block font-size-14" value="确认手机号码" />\n    </div>\n</form>\n'}),define("text!bower_components/login/templates/login.html",[],function(){return'<form class="js-login-form popout-login" method="GET" action="">\n    <div class="header c-green center">\n        <h2>该号码注册过，请直接登录</h2>\n    </div>\n    <fieldset class="wrapper-form font-size-14">\n        <div class="form-item">\n            <label for="phone">手机号</label>\n            <input id="phone" name="phone" type="tel" maxlength="11" autocomplete="off" placeholder="请输入你的手机号" disabled="disabled" value="<%= phone %>">\n        </div>\n        <div class="form-item">\n            <label for="password">密码</label>\n            <input id="passsword" name="password"  type="password" autocomplete="off" placeholder="请输入登录密码">\n        </div>\n        <div class="js-help-info font-size-12 error c-orange"></div>\n    </fieldset>\n    <div class="action-container">\n        <button type="button" class="js-confirm btn btn-green btn-block font-size-14">\n            <%= showBindText ? \'登录并绑定\' : \'确认\' %>\n        </button>\n    </div>\n    <div class="bottom-tips font-size-12">\n        <span class="c-orange">如果您忘了密码，请</span><a href="javascript:;" class="js-change-pwd c-blue">点此找回密码</a>\n        <a href="javascript:;" class="js-change-phone c-blue pull-right">更换手机号</a>\n    </div>\n</form>\n'}),define("text!bower_components/login/templates/register.html",[],function(){return'<form class="js-login-form popout-login" method="GET" action="">\n    <div class="header c-green center">\n        <h2>注册有赞帐号</h2>\n    </div>\n    <fieldset class="wrapper-form font-size-14">\n        <div class="form-item">\n            <label for="phone">手机号</label>\n            <input id="phone" name="phone" type="tel" maxlength="11" autocomplete="off" placeholder="请输入你的手机号" disabled="disabled" value="<%= phone %>">\n        </div>\n        <div class="form-item js-image-verify hide">\n            <label for="verifycode">身份校验</label>\n            <input id="verifycode" name="verifycode" class="js-verify-code item-input"  type="tel" style="width:178px" maxlength="6" autocomplete="off" placeholder="输入右侧数字">\n            <img class="js-verify-image verify-image" src="">\n        </div>\n        <div class="form-item">\n            <label for="code">验证码</label>\n            <input id="code" name="code"  type="text" style="width:178px" maxlength="6" autocomplete="off" placeholder="输入短信验证码">\n            <button type="button" class="js-auth-code tag btn-auth-code tag-green font-size-12" data-text="获取验证码">\n                获取验证码\n            </button>\n        </div>\n        <div class="form-item">\n            <label for="password">密码</label>\n            <input id="passsword" name="password"  type="password" autocomplete="off" maxlength="20" placeholder="请输入8-20位数字和字母组合">\n        </div>\n        <div class="js-help-info font-size-12 error c-orange"></div>\n    </fieldset>\n    <div class="action-container">\n        <button type="button" class="js-confirm btn btn-green btn-block font-size-14">\n            <%= showBindText ? \'注册并绑定\' : \'确认\' %>\n        </button>\n    </div>\n    <div class="bottom-tips font-size-12">\n        <span class="c-orange">如果您忘了密码，请</span><a href="javascript:;" class="js-change-pwd c-blue">点此找回密码</a>\n        <a href="javascript:;" class="js-change-phone c-blue pull-right">更换手机号</a>\n    </div>\n</form>\n'}),define("text!bower_components/login/templates/change_pwd.html",[],function(){
return'<form class="js-login-form popout-login" method="GET" action="">\n    <div class="header c-green center">\n        <h2><%if(isSetting){%>设定<%}else{%>找回<%}%>帐号密码</h2>\n    </div>\n    <fieldset class="wrapper-form font-size-14">\n        <div class="form-item">\n            <label for="phone">手机号</label>\n            <input id="phone" name="phone" type="tel" maxlength="11" autocomplete="off" placeholder="请输入你的手机号" disabled="disabled" value="<%= phone %>">\n        </div>\n        <div class="form-item js-image-verify hide">\n            <label for="verifycode">身份校验</label>\n            <input id="verifycode" name="verifycode" class="js-verify-code item-input"  type="tel" style="width:178px" maxlength="6" autocomplete="off" placeholder="输入右侧数字">\n            <img class="js-verify-image verify-image" src="">\n        </div>\n        <div class="form-item">\n            <label for="code">验证码</label>\n            <input id="code" name="code"  type="text" style="width:178px" maxlength="6" autocomplete="off" placeholder="输入短信验证码">\n            <button type="button" class="js-auth-code tag btn-auth-code font-size-12 tag-green" data-text="获取验证码">\n                获取验证码\n            </button>\n        </div>\n        <div class="form-item">\n            <label for="password">密码</label>\n            <input id="passsword" name="password"  type="password" autocomplete="off" placeholder="设置新的8-20位数字和字母组合密码">\n        </div>\n        <div class="js-help-info font-size-12 error c-orange"></div>\n    </fieldset>\n    <div class="action-container">\n        <button type="button" class="js-confirm btn btn-green btn-block font-size-14">确定</button>\n    </div>\n    <div class="bottom-tips pull-right">\n        <a href="javascript:;" class="js-login inline-item c-blue">已有帐号登录</a>\n        <a href="javascript:;" class="js-register inline-item c-blue">注册新帐号</a>\n    </div>\n</form>\n'}),define("zenjs/util/valid",[],function(){window.zenjs=window.zenjs||{};var t={validMobile:function(t){return t=""+t,/^((\+86)|(86))?(1)\d{10}$/.test(t)||/^\+?(9[976]\d|8[987530]\d|6[987]\d|5[90]\d|42\d|3[875]\d|2[98654321]\d|9[8543210]|8[6421]|6[6543210]|5[87654321]|4[987654310]|3[9643210]|2[70]|7|1|)-?\d{1,14}$/.test(t)},validPhone:function(t){return t=""+t,/^0[0-9\-]{10,13}$/.test(t)},validNumber:function(t){return/^\d+$/.test(t)},validEmail:function(t){return/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))$/i.test(t)},validPostalCode:function(t){return t=""+t,/^\d{6}$/.test(t)}};return window.zenjs.Valid=t,t}),window.Zepto&&function(t){t.fn.serializeArray=function(){var e,n,i=[],o=function(t){if(t.forEach)return t.forEach(o);i.push({name:e,value:t})};return this[0]&&t.each(this[0].elements,function(i,s){n=s.type,e=s.name,e&&"fieldset"!=s.nodeName.toLowerCase()&&!s.disabled&&"submit"!=n&&"reset"!=n&&"button"!=n&&"file"!=n&&("radio"!=n&&"checkbox"!=n||s.checked)&&o(t(s).val())}),i},t.fn.serialize=function(){var t=[];return this.serializeArray().forEach(function(e){t.push(encodeURIComponent(e.name)+"="+encodeURIComponent(e.value))}),t.join("&")},t.fn.submit=function(e){if(0 in arguments)this.bind("submit",e);else if(this.length){var n=t.Event("submit");this.eq(0).trigger(n),n.isDefaultPrevented()||this.get(0).submit()}return this}}(Zepto),define("vendor/zepto/form",function(){}),define("zenjs/util/form",["require","exports","module","vendor/zepto/form","jquery"],function(t,e,n){t("vendor/zepto/form");var i=t("jquery");window.zenjs=window.zenjs||{};var o={getFormData:function(t){var e=t.serializeArray(),n={};return i.map(e,function(t){n[t.name]=t.value}),n}};window.zenjs.Form=o,n.exports=o}),define("zenjs/sms_fetch/main",["require","exports","module","bower_components/ajax/ajax","zenjs/util/args","jquery"],function(t,e,n){function i(){this.loadingLock=!1,this.isUsed=void 0}function o(t){t=t||{},this.$el=a(t.el||t.$el||"<div></div>"),this.el=this.$el[0],this.$=function(t){return this.$el.find(t)},this.initialize&&this.initialize(t)}t("bower_components/ajax/ajax");var s=t("zenjs/util/args"),a=t("jquery"),r=function(){};i.prototype={fetch:function(){if(this.isUsed!==!1){var t=this;this.loadingLock=!0,a._ajax({url:window._global.url.www.replace(/^https?:\/\//,"//")+"/common/token/token.jsonp",type:"get",dataType:"jsonp"}).done(function(e){0==e.code?(t.token=e.data,t.loadingLock=!1,t.isUsed=!1):motify.log(e.msg)}).fail(function(){motify.log("token 获取失败")})}},get:function(){return this.isUsed=!0,this.token}};var l=new i;a.extend(o.prototype,{initialize:function(t){this.duration=t.time||60,this.step=t.step||1100,this.codeVerifyClass=t.codeVerifyClass||"js-verify-code",this.verifyType="smsFetch";var e=window._global.url.www.replace(/^https?:\/\//,"//");this.smsFetchUrl=e+"/common/sms/captcha.jsonp",this.imgUrl=e+"/common/sms/imgcaptcha",this.imgVerifyUrl=e+"/common/sms/imgcaptcha.jsonp",this.biz=t.biz||"kdt_account_captcha",this.onTimeChange=t.onTimeChange||r,this.onTimeEnd=t.onTimeEnd||r,this.onTimerStart=t.onTimerStart||r,this.onTimerClose=t.onTimerClose||r,this.onVerifyPictureShow=t.onVerifyPictureShow||r,this.onGetCodeError=t.onGetCodeError||r,this.onVerifyPictureSuccess=t.onVerifyPictureSuccess||r,this.onVerifyPictureError=t.onVerifyPictureError||r,this.platform=t.platform||"",this.subFrom=t.subFrom||"",l.fetch()},setMobile:function(t){t&&(this.mobile=t)},getImageCode:function(){return a.trim(this.$("."+this.codeVerifyClass).val())},getSms:function(t){var e=this;if(l.loadingLock)return void motify.log("数据加载中，稍后再试");if(t=t||{},t.mobile&&(this.mobile=t.mobile),!this.mobile)return!1;var n={smsFetch:e.onSmsFetchHandler,image:e.onImageHandler};return e.startTimer.call(e),(n[e.verifyType]||r).call(e),this},startTimer:function(){this.onTimerStart(),this.btnCountdown(this.duration)},stopTimer:function(){clearTimeout(this.timer),this.onTimerClose()},btnCountdown:function(t){var e=this;this.onTimeChange({second:t}),--t>=0?this.timer=setTimeout(function(){e.btnCountdown(t)},this.step):(this.onTimeEnd(),this.timer="")},onVerifyImageShow:function(t){this.$(".js-image-verify").removeClass("hide"),this.$(".js-verify-image").attr("src",t)},onVerifyImageHide:function(){this.$(".js-image-verify").addClass("hide")},onSmsFetchHandler:function(){var t=1;return function(){var e=this,n={verifyTimes:t,mobile:this.mobile,biz:this.biz,token:l.get()};this.platform&&(n.platform=this.platform),this.subFrom&&(n.sub_from=this.subFrom),a._ajax({url:this.smsFetchUrl,dataType:"jsonp",data:n,success:function(n){if(0==n.code)return void t++;e.stopTimer.call(e),e.onGetCodeError.call(e),10111===n.code?(e.verifyType="image",e.onVerifyImageShow(e.imgUrl),e.onVerifyPictureShow()):(t++,motify.log(n.msg))},error:function(n,i,o){t++,e.stopTimer.call(e),e.onGetCodeError.call(e),motify.log("获取验证码失败，请稍后再试")},complete:function(t,e){}}).always(function(){l.fetch()})}}(),onImageHandler:function(){var t=this,e=this.mobile;a._ajax({url:this.imgVerifyUrl,dataType:"jsonp",data:{mobile:e,captcha_code:this.getImageCode()},success:function(n){if(0===n.code)return t.verifyType="smsFetch",t.mobile=e,t.onVerifyImageHide(),t.onVerifyPictureSuccess(),void t.onSmsFetchHandler();t.stopTimer.call(t),t.onVerifyPictureError.call(t),10100===n.code?(motify.log(n.msg),t.reloadCaptcha()):motify.log(n.msg)},error:function(e,n,i){t.stopTimer.call(t),t.onVerifyPictureError.call(t),motify.log("图形验证失败，重试一下吧~"),t.reloadCaptcha()},complete:function(t,e){}})},reloadCaptcha:function(){var t=s.add(this.imgUrl,{stamp:new Date});this.$el.find(".js-verify-image").attr("src",t)}}),n.exports=o}),define("zenjs/util/url_helper",[],function(){return{site:function(t,e){var n=window._global.env,i=window._global.url;"static"===e&&"online"===n&&(e="cdn_static");var o=t;return e=e?i[e]||"":"",t.search(/^http[s]?\:\/\//)==-1&&("/"!==t[0]&&(t="/"+t),o=e+t),o},getCdnImageUrl:function(t,e){if(!t)return window._global.url.cdn_static+"/image/wap/no_pic.png";if(e=t.match(/.+\!\d+x\d+.+/)?"":e&&e.length>0?e:"!100x100.jpg",t.match(/^(https?:)?\/\//i)){for(var n=[/^(https?:)?\/\/imgqn.koudaitong.com/,/^(https?:)?\/\/kdt-img.koudaitong.com/,/^(https?:)?\/\/img.yzcdn.cn/,/^(https?:)?\/\/dn-kdt-img.qbox.me/],i=0;i<n.length;i++)t=t.replace(n[i],window._global.url.imgqn);return t+e}return window._global.url.imgqn+"/"+t+e}}}),define("bower_components/login/main",["require","bower_components/ajax/ajax","jquery","backbone","bower_components/aes/main","text!./templates/init.html","text!./templates/login.html","text!./templates/register.html","text!./templates/change_pwd.html","zenjs/util/valid","zenjs/util/form","zenjs/sms_fetch/main","zenjs/util/url_helper","zenjs/util/ua"],function(t){t("bower_components/ajax/ajax");var e=t("jquery"),n=t("backbone"),i=t("bower_components/aes/main"),o=t("text!./templates/init.html"),s=t("text!./templates/login.html"),a=t("text!./templates/register.html"),r=t("text!./templates/change_pwd.html"),l=t("zenjs/util/valid"),c=t("zenjs/util/form"),d=t("zenjs/sms_fetch/main"),u=t("zenjs/util/url_helper"),p=t("zenjs/util/ua"),h=["youzanmars"],f=window._global||{};return n.View.extend({events:{"click .js-confirm":"onConfirmClicked","click .js-change-phone":"onChangePhoneClicked","click .js-change-pwd":"onChangePwdClicked","click .js-login":"onLoginClicked","click .js-register":"onRegisterClicked","click .js-auth-code":"onAuthcodeClicked","click .js-verify-image":"onVerifyImageClicked","submit .js-login-form":"onConfirmClicked"},initialize:function(t){t=t||{};var n=p.getPlatform();if(h.indexOf(n)>-1||f.redirect_login_by_platform){var i=f.ajax_login_callback_inner||"/buyer/kdtunion?redirect_uri=",l=f.ajax_login_redirect_url?f.ajax_login_redirect_url+encodeURIComponent(window.location.href):window.location.href;return void(window.location.href=u.site(i+encodeURIComponent(l),"wap"))}var c=this,m=f.url;this.tpl_map={init:_.template(t.initTpl||o),login:_.template(t.loginTpl||s),register:_.template(t.registerTpl||a),changePwd:_.template(t.changePwdTpl||r)},this.valid_map={checkPhone:_(this.checkPhone).bind(this),checkPwd:_(this.checkPwd).bind(this),checkCode:_(this.checkCode).bind(this)},this.renderOpt=t.renderOpt||{type:"init",phone:""},this.renderOpt.showBindText=p.isWeixin()||p.isQQ(),this.urlMap={login:t.loginUrl||m.uic+"/buyer/auth/authlogin.json",register:t.registerUrl||m.uic+"/buyer/auth/authRegister.json",changePwd:t.changePwdUrl||m.uic+"/buyer/auth/changePassword.json",confirm:t.confirmUrl||m.uic+"/buyer/auth/authConfirm.json"},this.source=t.source||2,this.ajaxType=t.ajaxType||"POST",this.afterLogin=t.afterLogin||function(){};var g,v;p.isMobile()?(g="app",v="wsc",p.isWxd()?v="wxd":p.isWsc()?v="wsc":p.isPf()?v="pf":g="wap"):g="pc",this.sms=new d({el:this.$el,onTimeChange:function(t){var n=t.second;e(c.nAuthCode).text("等待 "+n+"秒")},onTimeEnd:function(){c.nAuthCode.text("再次获取"),c.nAuthCode.prop("disabled",!1),c.nAuthCode.removeClass("disabled"),c.nCodeInput.attr("placeholder","没有收到验证码？")},onTimerStart:function(){c.nAuthCode.prop("disabled",!0),c.nAuthCode.addClass("disabled")},onVerifyPictureError:function(){c.nAuthCode.removeAttr("disabled"),c.nAuthCode.removeClass("disabled"),c.nAuthCode.text("再次获取")},onGetCodeError:function(){c.nAuthCode.removeAttr("disabled"),c.nAuthCode.removeClass("disabled"),c.nAuthCode.text("再次获取")},onVerifyPictureShow:function(){c.nHelpInfo.html("操作过于频繁，请先输入图像验证码再获取")},onVerifyPictureSuccess:function(){c.nHelpInfo.html("")},platform:g,subFrom:v})},render:function(){return this.appLogined?this:(this.$el.html(this.tpl_map[this.renderOpt.type](this.renderOpt)),this.nForm=this.$(".js-login-form"),this.nHelpInfo=this.$(".js-help-info"),this.nPhone=this.$('input[name="phone"]'),this.nPwd=this.$('input[name="password"]'),this.nCodeInput=this.$('input[name="authcode"]'),this.nAuthCode=this.$(".js-auth-code"),this)},show:function(t,e){this.sms.biz="changePwd"==t?"reset_account_passwd":"kdt_account_captcha",_.extend(this.renderOpt,{type:t},e||{isSetting:!1}),this.render(this.renderOpt),this.$el.show(this.animationTime)},onConfirmClicked:function(t){t.preventDefault();var n=this,o=e(t.target),s=c.getFormData(n.nForm);if(s=_.extend(n.renderOpt,s),!n.validate(s))return!1;s.source=this.source,s.password&&(s.password=i.encrypt(s.password));var a=o.html();if("init"===n.renderOpt.type)n.renderOpt.phone=s.phone,e._ajax({url:this.urlMap.confirm,type:"POST",dataType:"json",timeout:15e3,data:s,xhrFields:{withCredentials:!0},beforeSend:function(){o.html("确认中..."),o.prop("disabled",!0)},success:function(t){switch(+t.code){case 0:n.show("login");break;case 135000003:n.show("register");break;default:n.nHelpInfo.html(t.msg)}},error:function(){n.nHelpInfo.html("出错啦，请重试")},complete:function(){o.html(a),o.prop("disabled",!1)}});else{var r=n.renderOpt.type;e._ajax({url:this.urlMap[r],type:this.ajaxType,dataType:"json",timeout:15e3,data:s,xhrFields:{withCredentials:!0},beforeSend:function(){o.html("确认中..."),o.prop("disabled",!0)},success:function(t){if(0===t.code){var i=t.data||{},o=[],s=e._ajax({url:"https://uic.koudaitong.com/sso/ticket/auth",type:"GET",dataType:"json",timeout:15e3,data:{ticket:i.ticket||""},xhrFields:{withCredentials:!0}});o.push(s);var a=(f.wap_url||{}).wap||"";/youzan\.com/.test(a)||o.push(e._ajax({url:a+"/buyer/auth/ssoConsist.json",type:"GET",dataType:"json",timeout:15e3,data:{uic_login_token:i.ticket||""},xhrFields:{withCredentials:!0}})),e.when.apply(e,o).always(function(){n.afterLogin(t,{type:r})})}else n.nHelpInfo.html(t.msg)},error:function(){n.nHelpInfo.html("出错啦，请重试")},complete:function(){o.html(a),o.prop("disabled",!1)}})}},onAuthcodeClicked:function(t){t.preventDefault();var e=c.getFormData(this.nForm);e=_.extend(this.renderOpt,e);var n=e.phone;this.sms.setMobile(n),this.sms.getSms()},onChangePhoneClicked:function(t){t.preventDefault(),this.show("init")},onChangePwdClicked:function(t){t.preventDefault(),this.sms.stopTimer(),this.show("changePwd")},onLoginClicked:function(t){t.preventDefault(),this.show("init")},onRegisterClicked:function(t){t.preventDefault(),this.show("init")},onVerifyImageClicked:function(t){t.preventDefault(),t.stopPropagation(),this.sms.reloadCaptcha()},validate:function(){var t={init:["checkPhone"],login:["checkPwd"],register:["checkCode","checkPwd"],changePwd:["checkCode","checkPwd"]};return function(e){return _.every(t[e.type],_(function(t){return this.valid_map[t](e)}).bind(this))}}(),checkPhone:function(t){return""===t.phone?(this.nHelpInfo.html("请填写您的手机号码"),!1):!!l.validMobile(t.phone)||(this.nHelpInfo.html("请填写11位手机号码"),!1)},checkPwd:function(t){if(""===t.password)return this.nHelpInfo.html("请输入您的密码"),!1;if("login"!==this.renderOpt.type&&t.password.length<8)return this.nHelpInfo.html("亲，密码最短为8位"),!1;if("login"!==this.renderOpt.type&&t.password.length>20)return this.nHelpInfo.html("亲，密码最长为20位"),!1;if("login"!==this.renderOpt.type){if(!function(t){var e=/[a-zA-Z]/g,n=/[0-9]/g,i=0,o=e.test(t),s=n.test(t);return o&&s&&(i=1),i}(t.password))return this.nHelpInfo.html("亲，密码为8-20位数字和字母组合"),!1}return!0},checkCode:function(t){return!!l.validPostalCode(t.code)||(this.nHelpInfo.html("请填写6位短信验证码"),!1)}})}),define("text!wap/components/new_cart/templates/close_warn.html",[],function(){return'<div class="close-pop-box text-center">\n\t<h3 class="font-size-18">\n\t\t提醒\n\t</h3>\n\t<p class="font-size-14">绑定手机号，有助于订单查询哦～</p>\n\t<div class="action-container">\n\t\t<div class="btn-2-1">\n\t\t\t<button class="btn btn-white font-size-14 js-cancel">我知道了</button>\n\t\t</div>\n\t\t<div class="btn-2-1">\n\t\t\t<button class="btn btn-green font-size-14 js-ok">明日再提醒</button>\n\t\t</div>\n\t</div>\n</div'}),define("wap/trade/cart/component/login",["require","text!../templates/login.html","bower_components/pop/popout_box","bower_components/login/main","text!wap/components/new_cart/templates/close_warn.html","zenjs/util/local_storage"],function(t){"use strict";var e=t("text!../templates/login.html"),n=t("bower_components/pop/popout_box"),i=t("bower_components/login/main"),o=t("text!wap/components/new_cart/templates/close_warn.html"),s=t("zenjs/util/local_storage");return{props:["isAppCart"],template:e,methods:{onLoginBtnClick:function(){var t=new n({contentViewClass:i,contentViewOptions:{afterLogin:function(e){t.hide(),window.location.reload()}}});t.render().show()},onCloseLoginClick:function(){var t=this,e=new n({html:_.template(o),transparent:".8",className:"no-padding",width:"240px",onOKClicked:function(){e.hide(),t.$emit("okClicked"),s.setItem("close_login_tip_time",(new Date).getTime())}}).render().show()}}}}),define("text!wap/trade/cart/templates/shop.html",[],function(){return'<div class="block block-order block-cart">\n    <div class="header">\n        <div class="select-group js-select-group" @click="allCheckClick">\n            <span class="check" :class="{checked: isEditing?allHasDeleteMark:allHasChooseMark}"></span>\n        </div>\n        <a class="shop-title" :href="shopUrl"><i class="custom-store-img">店铺：</i>{{name}}</a>\n\n        <!-- 只允许一个店铺处于编辑状态控制逻辑 -->\n        <template v-if="!(hasEditing&&!isEditing)">\n            <a href="javascript:;" data-type="cart" class="j-edit-list pull-right c-blue font-size-12 edit-list" @click="editClick">\n                <template v-if="isEditing">\n                    完成\n                </template>\n        <template v-if="!isEditing">\n                    编辑\n                </template>\n        </a>\n        </template>\n\n    </div>\n\n    <template v-if="onlyPayOnDeliver">\n        <div class="tips center">\n            该店铺仅支持货到付款，请单独下单购买\n        </div>\n    </template>\n\n    <!-- 打包一口价 -->\n    <template v-for="(packageData,index) in packageList">\n        <vm-package :key="index" \n        :packageData="packageData" :isEditing="isEditing"  ></vm-package>\n    </template>\n    <!-- 没有参加活动的商品 -->\n    <div>\n        <ul class="js-list block block-list block-list-cart border-0">\n            <template v-for="(goods,goodsIndex) in goodsList">\n                <li class="block-item block-item-cart" :key="goods.alias" :class="{editing:isEditing}">\n                    <vm-goods :goods="goods" :invalid="false" :isEditing="isEditing" ></vm-goods>\n                </li>\n            </template>\n        </ul>\n    </div>\n\n</div>'}),define("text!wap/trade/cart/templates/goods.html",[],function(){return'<div>\n\n    <div class="check-container" :class="{hide:invalid}" @click="checkClick">\n        <span class="check" :class="{checked:isEditing?deleteMark:chooseMark}">\n       </span>\n    </div>\n    <div class="name-card clearfix">\n        <a :href="goodsLink" @click.stop.prevent="goodsLinkClick" class="thumb js-goods-link">\n            <img class="js-lazy" :data-src="imageUrl">\n            <span v-if="packagePrice" class="bale-tag">一口价</span>\n        </a>\n        <div class="detail">\n            <a class="js-goods-link" :href="goodsLink" @click.stop.prevent="goodsLinkClick">\n                <h3 class="title js-ellipsis"><i>{{title}}</i></h3>\n            </a>\n            <p class="sku ellipsis">\n                {{skuStr}}\n            </p>\n            <div class="num">\n\n                <template v-if="!isEditing">\n                    &times;<span class="num-txt">{{num}}</span>\n                </template>\n\n                <template v-if="isEditing">\n                    <vm-quantity :num="num" :minimalNum="1"\n                     :exceedLimitMsg="stockNum > limitNum ?\'就这么几件啦～\' : (\'该商品每人限购\' + limitNum + \'件\')"\n                     :limitNum="stockNum > limitNum ? stockNum : limitNum" @numChange="numChange" ></vm-quantity>\n                </template>\n            </div>\n\n\n            <template v-if="!invalid">\n                <div class="price c-orange">\n                    ¥<span>{{(pay_price/100).toFixed(2) }} </span>\n                </div>\n            </template>\n\n\n        </div>\n        <div class="error-box">{{error_msg }}</div>\n    </div>\n    <div class="delete-btn" @click="deleteGoodsMt"><span>删除</span></div>\n\n</div>\n'}),define("wap/trade/cart/component/quantity",["require"],function(t){"use strict";var e=/^[0-9]*[1-9][0-9]*$/;return{template:'         <div class="quantity">            <button class="minus " :class="{disabled:internalNum <= (minimalNum || 1)}" type="button" :disabled="readonly" ></button>            <input type="text" class="txt" v-model.number="internalNum" @blur="onBlur" @focus="onFocus" :readonly="readonly" pattern="[0-9]*" />            <button class="plus " :class="{disabled:internalNum >= (limitNum || 999999) }"  type="button" :disabled="readonly" ></button>            <div class="response-area response-area-minus" @click="onSubClicked"></div>            <div class="response-area response-area-plus" @click="onAddClicked"></div>        </div>        ',props:["readonly","num","limitNum","minimalNum","exceedLimitMsg"],data:function(){return{internalNum:this.num}},methods:{onSubClicked:function(t){this.readonly||(this.internalNum>this.minimalNum&&(this.internalNum-=1),this.$emit("numChange",this.internalNum))},onAddClicked:function(){this.readonly||(this.internalNum<this.limitNum&&(this.internalNum+=1),this.$emit("numChange",this.internalNum))},changeNum:function(t){this.readonly||(t>this.limitNum&&(this.exceedLimitMsg&&motify.log(this.exceedLimitMsg),this.onOverLimit(t,this.limitNum),this.internalNum=this.limitNum),t<this.minimalNum&&(this.onBelowLeast(t,this.minimalNum),this.internalNum=this.minimalNum))},onBlur:function(t){this.internalNum=e.test(this.internalNum)?parseInt(this.internalNum,10):1,this.internalNum>this.limitNum&&(this.internalNum=this.limitNum,this.exceedLimitMsg&&motify.log(this.exceedLimitMsg)),this.internalNum<this.minimalNum&&(this.internalNum=this.minimalNum),this.$emit("numChange",this.internalNum)},onFocus:function(t){var e=t.target;"function"==typeof e.select&&e.select(),setTimeout(function(){"function"==typeof e.setSelectionRange&&e.setSelectionRange(0,9999)},1)}}}}),define("text!bower_components/pop/pop_confirm/box.html",[],function(){return'<% if (title) { %>\n<h1 class="center font-size-16"><%= title %></h1>\n<% } %>\n<div class="confirm-content font-size-14<% if (title) { %> c-gray-dark<% } %>" style="line-height: 20px; padding: 5px 5px 10px;">\n    <%= content %>\n</div>\n<hr style="margin: 9px -15px 10px;" />\n<div class="btn-2-1">\n    <p class="js-cancel center font-size-16" style="padding-top: 5px;"><%= cancelBtn %></p>\n</div><div class="btn-2-1">\n    <p class="js-ok center c-green font-size-16" style="padding-top: 5px;"><%= okBtn %></p>\n</div>'}),define("zenjs/util/template",["require","jquery"],function(t){var e=t("jquery"),n=function(){var t={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;"},e=["&","<",">",'"',"'"],n=new RegExp("["+e.join("")+"]","g");return function(e){return null==e?"":(""+e).replace(n,function(e){return t[e]})}}(),i={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g},o={"'":"'","\\":"\\","\r":"r","\n":"n","\t":"t","\u2028":"u2028","\u2029":"u2029"};return function(t,s,a){var r;a=e.extend({},i,a);var l=new RegExp([(a.escape||/(.)^/).source,(a.interpolate||/(.)^/).source,(a.evaluate||/(.)^/).source].join("|")+"|$","g"),c=0,d="__p+='";t.replace(l,function(e,n,i,s,a){return d+=t.slice(c,a).replace(/\\|'|\r|\n|\t|\u2028|\u2029/g,function(t){return"\\"+o[t]}),n&&(d+="'+\n((__t=("+n+"))==null?'':escapeFunc(__t))+\n'"),i&&(d+="'+\n((__t=("+i+"))==null?'':__t)+\n'"),s&&(d+="';\n"+s+"\n__p+='"),c=a+e.length,e}),d+="';\n",a.variable||(d="with(obj||{}){\n"+d+"}\n"),d="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+d+"return __p;\n";try{r=new Function(a.variable||"obj","escapeFunc",d)}catch(t){throw t.source=d,t}if(s)return r(s,n);var u=function(t){return r.call(this,t,n)};return u.source="function("+(a.variable||"obj")+"){\n"+d+"}",u}}),define("bower_components/pop/pop_confirm/popout_confirm",["require","../popout_box","text!../pop_confirm/box.html","zenjs/util/template"],function(t){var e=t("../popout_box"),n=t("text!../pop_confirm/box.html"),i=t("zenjs/util/template"),o=i(n),s=e.extend({init:function(t){this._super(t),this.isCanNotHide=!0,this.title=t.title||"",this.content=t.content||"",this.okBtn=t.okBtn||"确定",this.cancelBtn=t.cancelBtn||"取消"},render:function(t){return this.html||(this.html=o({title:this.title,content:this.content,okBtn:this.okBtn,cancelBtn:this.cancelBtn})),this._super(t),this.nPopContainer.addClass("popout-confirm"),this}}),a=null;return{show:function(t,e){e=e||{},a&&this.hide(),e.content=t,a=new s(e).render().show()},hide:function(){a&&(a.hide(),a=null)}}}),function(t){"use strict";function e(e){return!e||void 0!==e.allowPageScroll||void 0===e.swipe&&void 0===e.swipeStatus||(e.allowPageScroll=c),void 0!==e.click&&void 0===e.tap&&(e.tap=e.click),e||(e={}),e=t.extend({},t.fn.swipe.defaults,e),this.each(function(){var i=t(this),o=i.data(T);o||(o=new n(this,e),i.data(T,o))})}function n(e,n){function z(e){if(!(ct()||t(e.target).closest(n.excludedElements,Vt).length>0)){var i,o=e.originalEvent?e.originalEvent:e,s=C?o.touches[0]:o;return qt=y,(C?Ut=o.touches.length:e.preventDefault(),Ht=0,Ot=null,Gt=null,Bt=0,At=0,$t=0,Nt=1,It=0,Wt=ft(),Rt=vt(),rt(),!C||Ut===n.fingers||n.fingers===w||R()?(ut(0,s),Kt=St(),2==Ut&&(ut(1,o.touches[1]),At=$t=yt(Wt[0].start,Wt[1].start)),(n.swipeStatus||n.pinchStatus)&&(i=H(o,qt))):i=!1,i===!1)?(qt=x,H(o,qt),i):(n.hold&&(te=setTimeout(t.proxy(function(){Vt.trigger("hold",[o.target]),n.hold&&(i=n.hold.call(Vt,o,o.target))},this),n.longTapThreshold)),dt(!0),null)}}function F(t){var e=t.originalEvent?t.originalEvent:t;if(qt!==k&&qt!==x&&!lt()){var i,o=C?e.touches[0]:e,s=pt(o);if(Xt=St(),C&&(Ut=e.touches.length),n.hold&&clearTimeout(te),qt=b,2==Ut&&(0==At?(ut(1,e.touches[1]),At=$t=yt(Wt[0].start,Wt[1].start)):(pt(e.touches[1]),$t=yt(Wt[0].end,Wt[1].end),Gt=kt(Wt[0].end,Wt[1].end)),Nt=bt(At,$t),It=Math.abs(At-$t)),Ut===n.fingers||n.fingers===w||!C||R()){if(Ot=jt(s.start,s.end),I(t,Ot),Ht=xt(s.start,s.end),Bt=_t(),mt(Ot,Ht),(n.swipeStatus||n.pinchStatus)&&(i=H(e,qt)),n.triggerOnTouchEnd||n.triggerOnTouchLeave){var a=!0;if(n.triggerOnTouchLeave){var r=Tt(this);a=zt(s.end,r)}!n.triggerOnTouchEnd&&a?qt=M(b):n.triggerOnTouchLeave&&!a&&(qt=M(k)),qt!=x&&qt!=k||H(e,qt)}}else qt=x,H(e,qt);i===!1&&(qt=x,H(e,qt))}}function E(t){var e=t.originalEvent?t.originalEvent:t;return C&&e.touches.length>0?(at(),!0):(lt()&&(Ut=Yt),Xt=St(),Bt=_t(),A()||!B()?(qt=x,H(e,qt)):n.triggerOnTouchEnd||0==n.triggerOnTouchEnd&&qt===b?(t.preventDefault(),qt=k,H(e,qt)):!n.triggerOnTouchEnd&&J()?(qt=k,O(e,qt,h)):qt===b&&(qt=x,H(e,qt)),dt(!1),null)}function P(){Ut=0,Xt=0,Kt=0,At=0,$t=0,Nt=1,rt(),dt(!1)}function L(t){var e=t.originalEvent?t.originalEvent:t;n.triggerOnTouchLeave&&(qt=M(k),H(e,qt))}function D(){Vt.unbind(Et,z),Vt.unbind(Mt,P),Vt.unbind(Pt,F),Vt.unbind(Lt,E),Dt&&Vt.unbind(Dt,L),dt(!1)}function M(t){var e=t,i=N(),o=B(),s=A();return!i||s?e=x:!o||t!=b||n.triggerOnTouchEnd&&!n.triggerOnTouchLeave?!o&&t==k&&n.triggerOnTouchLeave&&(e=x):e=k,e}function H(t,e){var n=void 0;return W()||U()?n=O(t,e,u):(V()||R())&&n!==!1&&(n=O(t,e,p)),ot()&&n!==!1?n=O(t,e,f):st()&&n!==!1?n=O(t,e,m):it()&&n!==!1&&(n=O(t,e,h)),e===x&&P(t),e===k&&(C?0==t.touches.length&&P(t):P(t)),n}function O(e,c,d){var g=void 0;if(d==u){if(Vt.trigger("swipeStatus",[c,Ot||null,Ht||0,Bt||0,Ut,Wt]),n.swipeStatus&&(g=n.swipeStatus.call(Vt,e,c,Ot||null,Ht||0,Bt||0,Ut,Wt))===!1)return!1;if(c==k&&q()){if(Vt.trigger("swipe",[Ot,Ht,Bt,Ut,Wt]),n.swipe&&(g=n.swipe.call(Vt,e,Ot,Ht,Bt,Ut,Wt))===!1)return!1;switch(Ot){case i:Vt.trigger("swipeLeft",[Ot,Ht,Bt,Ut,Wt]),n.swipeLeft&&(g=n.swipeLeft.call(Vt,e,Ot,Ht,Bt,Ut,Wt));break;case o:Vt.trigger("swipeRight",[Ot,Ht,Bt,Ut,Wt]),n.swipeRight&&(g=n.swipeRight.call(Vt,e,Ot,Ht,Bt,Ut,Wt));break;case s:Vt.trigger("swipeUp",[Ot,Ht,Bt,Ut,Wt]),n.swipeUp&&(g=n.swipeUp.call(Vt,e,Ot,Ht,Bt,Ut,Wt));break;case a:Vt.trigger("swipeDown",[Ot,Ht,Bt,Ut,Wt]),n.swipeDown&&(g=n.swipeDown.call(Vt,e,Ot,Ht,Bt,Ut,Wt))}}}if(d==p){if(Vt.trigger("pinchStatus",[c,Gt||null,It||0,Bt||0,Ut,Nt,Wt]),n.pinchStatus&&(g=n.pinchStatus.call(Vt,e,c,Gt||null,It||0,Bt||0,Ut,Nt,Wt))===!1)return!1;if(c==k&&G())switch(Gt){case r:Vt.trigger("pinchIn",[Gt||null,It||0,Bt||0,Ut,Nt,Wt]),n.pinchIn&&(g=n.pinchIn.call(Vt,e,Gt||null,It||0,Bt||0,Ut,Nt,Wt));break;case l:Vt.trigger("pinchOut",[Gt||null,It||0,Bt||0,Ut,Nt,Wt]),n.pinchOut&&(g=n.pinchOut.call(Vt,e,Gt||null,It||0,Bt||0,Ut,Nt,Wt))}}return d==h?c!==x&&c!==k||(clearTimeout(Zt),clearTimeout(te),Y()&&!tt()?(Qt=St(),Zt=setTimeout(t.proxy(function(){Qt=null,Vt.trigger("tap",[e.target]),n.tap&&(g=n.tap.call(Vt,e,e.target))},this),n.doubleTapThreshold)):(Qt=null,Vt.trigger("tap",[e.target]),n.tap&&(g=n.tap.call(Vt,e,e.target)))):d==f?c!==x&&c!==k||(clearTimeout(Zt),Qt=null,Vt.trigger("doubletap",[e.target]),n.doubleTap&&(g=n.doubleTap.call(Vt,e,e.target))):d==m&&(c!==x&&c!==k||(clearTimeout(Zt),Qt=null,Vt.trigger("longtap",[e.target]),n.longTap&&(g=n.longTap.call(Vt,e,e.target)))),g}function B(){var t=!0;return null!==n.threshold&&(t=Ht>=n.threshold),t}function A(){var t=!1;return null!==n.cancelThreshold&&null!==Ot&&(t=gt(Ot)-Ht>=n.cancelThreshold),t}function $(){return null===n.pinchThreshold||It>=n.pinchThreshold}function N(){return!n.maxTimeThreshold||!(Bt>=n.maxTimeThreshold)}function I(t,e){if(n.allowPageScroll===c||R())t.preventDefault();else{var r=n.allowPageScroll===d;switch(e){case i:(n.swipeLeft&&r||!r&&n.allowPageScroll!=g)&&t.preventDefault();break;case o:(n.swipeRight&&r||!r&&n.allowPageScroll!=g)&&t.preventDefault();break;case s:(n.swipeUp&&r||!r&&n.allowPageScroll!=v)&&t.preventDefault();break;case a:(n.swipeDown&&r||!r&&n.allowPageScroll!=v)&&t.preventDefault()}}}function G(){var t=K(),e=X(),n=$();return t&&e&&n}function R(){return!!(n.pinchStatus||n.pinchIn||n.pinchOut)}function V(){return!(!G()||!R())}function q(){var t=N(),e=B(),n=K(),i=X();return!A()&&i&&n&&e&&t}function U(){return!!(n.swipe||n.swipeStatus||n.swipeLeft||n.swipeRight||n.swipeUp||n.swipeDown)}function W(){return!(!q()||!U())}function K(){return Ut===n.fingers||n.fingers===w||!C}function X(){return 0!==Wt[0].end.x}function J(){return!!n.tap}function Y(){return!!n.doubleTap}function Q(){return!!n.longTap}function Z(){if(null==Qt)return!1;var t=St();return Y()&&t-Qt<=n.doubleTapThreshold}function tt(){return Z()}function et(){return(1===Ut||!C)&&(isNaN(Ht)||Ht<n.threshold)}function nt(){return Bt>n.longTapThreshold&&Ht<_}function it(){return!(!et()||!J())}function ot(){return!(!Z()||!Y())}function st(){return!(!nt()||!Q())}function at(){Jt=St(),Yt=event.touches.length+1}function rt(){Jt=0,Yt=0}function lt(){var t=!1;if(Jt){St()-Jt<=n.fingerReleaseThreshold&&(t=!0)}return t}function ct(){return!(Vt.data(T+"_intouch")!==!0)}function dt(t){t===!0?(Vt.bind(Pt,F),Vt.bind(Lt,E),Dt&&Vt.bind(Dt,L)):(Vt.unbind(Pt,F,!1),Vt.unbind(Lt,E,!1),Dt&&Vt.unbind(Dt,L,!1)),Vt.data(T+"_intouch",t===!0)}function ut(t,e){var n=void 0!==e.identifier?e.identifier:0;return Wt[t].identifier=n,Wt[t].start.x=Wt[t].end.x=e.pageX||e.clientX,Wt[t].start.y=Wt[t].end.y=e.pageY||e.clientY,Wt[t]}function pt(t){var e=void 0!==t.identifier?t.identifier:0,n=ht(e);return n.end.x=t.pageX||t.clientX,n.end.y=t.pageY||t.clientY,n}function ht(t){
for(var e=0;e<Wt.length;e++)if(Wt[e].identifier==t)return Wt[e]}function ft(){for(var t=[],e=0;e<=5;e++)t.push({start:{x:0,y:0},end:{x:0,y:0},identifier:0});return t}function mt(t,e){e=Math.max(e,gt(t)),Rt[t].distance=e}function gt(t){if(Rt[t])return Rt[t].distance}function vt(){var t={};return t[i]=wt(i),t[o]=wt(o),t[s]=wt(s),t[a]=wt(a),t}function wt(t){return{direction:t,distance:0}}function _t(){return Xt-Kt}function yt(t,e){var n=Math.abs(t.x-e.x),i=Math.abs(t.y-e.y);return Math.round(Math.sqrt(n*n+i*i))}function bt(t,e){return(e/t*1).toFixed(2)}function kt(){return Nt<1?l:r}function xt(t,e){return Math.round(Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2)))}function Ct(t,e){var n=t.x-e.x,i=e.y-t.y,o=Math.atan2(i,n),s=Math.round(180*o/Math.PI);return s<0&&(s=360-Math.abs(s)),s}function jt(t,e){var n=Ct(t,e);return n<=45&&n>=0?i:n<=360&&n>=315?i:n>=135&&n<=225?o:n>45&&n<135?a:s}function St(){return(new Date).getTime()}function Tt(e){e=t(e);var n=e.offset();return{left:n.left,right:n.left+e.outerWidth(),top:n.top,bottom:n.top+e.outerHeight()}}function zt(t,e){return t.x>e.left&&t.x<e.right&&t.y>e.top&&t.y<e.bottom}var Ft=C||S||!n.fallbackToMouseEvents,Et=Ft?S?j?"MSPointerDown":"pointerdown":"touchstart":"mousedown",Pt=Ft?S?j?"MSPointerMove":"pointermove":"touchmove":"mousemove",Lt=Ft?S?j?"MSPointerUp":"pointerup":"touchend":"mouseup",Dt=Ft?null:"mouseleave",Mt=S?j?"MSPointerCancel":"pointercancel":"touchcancel",Ht=0,Ot=null,Bt=0,At=0,$t=0,Nt=1,It=0,Gt=0,Rt=null,Vt=t(e),qt="start",Ut=0,Wt=null,Kt=0,Xt=0,Jt=0,Yt=0,Qt=0,Zt=null,te=null;try{Vt.bind(Et,z),Vt.bind(Mt,P)}catch(e){t.error("events not supported "+Et+","+Mt+" on jQuery.swipe")}this.enable=function(){return Vt.bind(Et,z),Vt.bind(Mt,P),Vt},this.disable=function(){return D(),Vt},this.destroy=function(){return D(),Vt.data(T,null),Vt},this.option=function(e,i){if(void 0!==n[e]){if(void 0===i)return n[e];n[e]=i}else t.error("Option "+e+" does not exist on jQuery.swipe.options");return null}}var i="left",o="right",s="up",a="down",r="in",l="out",c="none",d="auto",u="swipe",p="pinch",h="tap",f="doubletap",m="longtap",g="horizontal",v="vertical",w="all",_=10,y="start",b="move",k="end",x="cancel",C="ontouchstart"in window,j=window.navigator.msPointerEnabled&&!window.navigator.pointerEnabled,S=window.navigator.pointerEnabled||window.navigator.msPointerEnabled,T="TouchSwipe",z={fingers:1,threshold:75,cancelThreshold:null,pinchThreshold:20,maxTimeThreshold:null,fingerReleaseThreshold:250,longTapThreshold:500,doubleTapThreshold:200,swipe:null,swipeLeft:null,swipeRight:null,swipeUp:null,swipeDown:null,swipeStatus:null,pinchIn:null,pinchOut:null,pinchStatus:null,click:null,tap:null,doubleTap:null,longTap:null,hold:null,triggerOnTouchEnd:!0,triggerOnTouchLeave:!1,allowPageScroll:"auto",fallbackToMouseEvents:!0,excludedElements:"label, button, input, select, textarea, a, .noSwipe"};t.fn.swipe=function(n){var i=t(this),o=i.data(T);if(o&&"string"==typeof n){if(o[n])return o[n].apply(this,Array.prototype.slice.call(arguments,1));t.error("Method "+n+" does not exist on jQuery.swipe")}else if(!(o||"object"!=typeof n&&n))return e.apply(this,arguments);return i},t.fn.swipe.defaults=z,t.fn.swipe.phases={PHASE_START:y,PHASE_MOVE:b,PHASE_END:k,PHASE_CANCEL:x},t.fn.swipe.directions={LEFT:i,RIGHT:o,UP:s,DOWN:a,IN:r,OUT:l},t.fn.swipe.pageScroll={NONE:c,HORIZONTAL:g,VERTICAL:v,AUTO:d},t.fn.swipe.fingers={ONE:1,TWO:2,THREE:3,ALL:w}}($),define("vendor/jquery_touchSwipe",function(){}),define("wap/components/loading",["bower_components/pop/pop"],function(t){var e,n=t.extend({init:function(t){t=t||{},this._super(t),this.css={position:"fixed",opacity:1,top:"50%",left:"50%","-webkit-transform":"translate3d(-50%, -50%, 0)",transform:"translateY(-50%, -50%, 0)"},this.nPopContainer.css(this.css)}});return{show:function(t){t=t||"处理中",e&&this.hide(),e=new n({html:'<div class="loader-container"><div class="loader center">'+t+"</div></div>",isCanNotHide:!0,transparent:".6"}).render().show()},hide:function(){e&&e.hide(),e=null}}}),define("wap/trade/cart/component/goods",["require","text!../templates/goods.html","../api/cartapi","./quantity","zenjs/util/args","zenjs/util/url_helper","wap/trade/cart/api/cartapi","bower_components/youzanjsbridge/api","bower_components/pop/pop_confirm/popout_confirm","vendor/jquery_touchSwipe","wap/components/loading"],function(t){"use strict";var e=t("text!../templates/goods.html"),n=t("../api/cartapi"),i=t("./quantity"),o=t("zenjs/util/args"),s=t("zenjs/util/url_helper"),n=t("wap/trade/cart/api/cartapi"),a=t("bower_components/youzanjsbridge/api"),r=t("bower_components/pop/pop_confirm/popout_confirm"),l=(t("vendor/jquery_touchSwipe"),t("wap/components/loading"));return{props:["goods","isEditing","invalid","packagePrice"],template:e,components:{"vm-quantity":i},computed:{goodsLink:function(){return o.add(n.goodsLink,{alias:this.goods.alias})},chooseMark:function(){return this.goods.chooseMark},deleteMark:function(){return this.goods.deleteMark},imageUrl:function(){return s.getCdnImageUrl(this.goods.attachment_url,"!200x200.jpg")},title:function(){return this.goods.title},skuStr:function(){return _.map(this.goods.sku&&JSON.parse(this.goods.sku)||[],function(t){return t.v}).join("，")},num:function(){return this.goods.num},error_msg:function(){return this.goods.error_msg},pay_price:function(){return this.goods.pay_price},kdtId:function(){return this.goods.kdt_id},skuId:function(){return this.goods.sku_id},goodsId:function(){return this.goods.goods_id},storeId:function(){return this.goods.store_id},stockNum:function(){return this.goods.stock_num},limitNum:function(){return this.goods.limit_num},setCheckStatusInLS:function(){}},watch:{chooseMark:function(t,e){n.setCheckStatus(this.goods.kdt_id,this.goods.goods_id,this.goods.sku_id,this.goods.chooseMark)}},mounted:function(){$(this.$el).swipe({triggerOnTouchEnd:!1,swipeStatus:this.swipeStatus(),allowPageScroll:"vertical"})},methods:{checkClick:function(){this.isEditing?this.goods.deleteMark=!this.goods.deleteMark:this.goods.chooseMark=!this.goods.chooseMark},numChange:function(t){this.goods.num=t;var e=this;n.setNum(e.kdtId,e.skuId,e.goodsId,e.storeId,t).done(function(){if(e.packagePrice){n.getCart().done(function(t){window.vueEventbus.$emit("updatePackageState",t)})}})},deleteGoodsMt:function(){var t=this;r.show("确认要删除该商品吗？",{onOKClicked:function(){l.show();var e=n.deleteGoods(t.kdtId,t.skuId,t.goodsId,t.storeId);e.done(function(){if(window.vueEventbus.$emit("deleteGoods",t.kdtId,t.goodsId,t.skuId),t.packagePrice){var e=n.getCart();e.done(function(t){l.hide(),window.vueEventbus.$emit("updatePackageState",t)}),e.fail(function(t){l.hide(),motify.log(t)})}else l.hide()}),e.fail(function(e){t.packagePrice||l.hide(),motify.log(e)})}})},goodsLinkClick:function(t){if(!this.isEditing)return n.isAppCart?void a.gotoWebview({url:this.goodsLink,page:"web"}):void(location.href=this.goodsLink)},swipeStatus:function(){var t,e,n=this,i=0,o=0,s=!1,a=!1,r=function(t){e=e||-.38*this.width(),t<e||(this.css("-webkit-transform","translate3d("+t+"px, 0, 0)"),this.css("transform","translate3d("+t+"px, 0, 0)"))},l=function(){r.call(this,-60),this.addClass("ajust"),s=!0},c=function(){r.call(this,0),s=!1};return function(e,d,u,p,h){if("up"!=u&&"down"!=u||(a=!0,t&&clearTimeout(t),t=setTimeout(function(){a=!1},500)),!n.isEditing&&!a)if("start"==d&&(this.removeClass("ajust"),s&&r.call(this,-60),i=this.offset().left,o=i),"move"!=d||"left"!=u&&"right"!=u)"cancel"!=d&&"end"!=d||(s?p>20&&"right"==u?c.call(this):l.call(this):p>60&&"left"==u?l.call(this):c.call(this));else if(s){o=p;var f="left"==u?i-p:i+p;f>0&&(f=0),r.call(this,f)}else{if(p>o&&"right"==u)return void r.call(this,0);o=p,r.call(this,-1*(i+p))}}}}}}),define("text!wap/trade/cart/templates/package.html",[],function(){return'<div>\n    <div class="block bale-cart-title top-0" :class="{\'go-package-list\':(packageData.isBaled === false)}">\n        <a class="bale-cart-link clearfix">\n            <div class="name">\n                <span class="tag">打包一口价</span>\n                <span class="bale-info">{{packageData.desc}}</span>\n            </div>\n            <div class="bale-tips">\n                <span v-if="packageData.isBaled === true" class="tip-content">已满足</span>\n                <span v-if="packageData.isBaled === false" class="tip-content"><a :href="packageData.baleUrl">去凑单</a></span>\n            </div>\n        </a>\n    </div>\n\n    <ul class="js-list block block-list block-list-cart border-0">\n        <template v-for="(goods,goodsIndex) in goodsList">\n            <li class="block-item block-item-cart bale-cart" :key="goods.alias" :class="{editing:isEditing}">\n                <vm-goods :goods="goods" :invalid="false" :isEditing="isEditing" :packagePrice="true"></vm-goods>\n            </li>\n        </template>\n    </ul>\n</div>'}),define("wap/trade/cart/component/package",["require","text!../templates/package.html","./goods"],function(t){"use strict";return{props:["packageData","isEditing"],template:t("text!../templates/package.html"),components:{"vm-goods":t("./goods")},computed:{goodsList:function(){return this.packageData.goods}}}}),define("wap/trade/cart/component/shop",["require","text!../templates/shop.html","./goods","./package"],function(t){"use strict";return{template:t("text!../templates/shop.html"),props:["shop","shopSate","hasEditing"],components:{"vm-goods":t("./goods"),"vm-package":t("./package")},computed:{name:function(){return this.shopSate.name},shopUrl:function(){return this.shop.shopUrl},onlyPayOnDeliver:function(){var t=this.shop.pay_ways;return t&&1===t.length&&9==+t[0].key},packageList:function(){var t=this,e=[];return _.each(this.shop.activity_info.goods_activity_filter_info_list,function(n){var i={id:n.activity_id,desc:n.activity_desc,isBaled:n.is_baled,baleUrl:n.bale_url,goods:[]};_.each(n.goods_list,function(e){var n=_.find(t.shop.goods_list,function(t){return e.goods_id==t.goods_id&&e.sku_id==t.sku_id});n&&i.goods.push(n)}),i.goods&&i.goods.length>0&&e.push(i)}),e},goodsList:function(){var t={};_.each(this.shop.activity_info.goods_activity_filter_info_list,function(e){_.each(e.goods_list,function(e){t[e.goods_id+"-"+e.sku_id]=!0})});var e=[];return _.each(this.shop.goods_list,function(n){t[n.goods_id+"-"+n.sku_id]||e.push(n)}),e},isEditing:function(){return this.shop.isEditing},allHasChooseMark:{get:function(){return this.shopSate.allHasChooseMark},set:function(t){_.each(this.shop.goods_list,function(e){e.chooseMark=t})}},allHasDeleteMark:{get:function(){return this.shopSate.allHasDeleteMark},set:function(t){_.each(this.shop.goods_list,function(e){e.deleteMark=t})}}},methods:{allCheckClick:function(){this.isEditing?this.allHasDeleteMark=!this.allHasDeleteMark:this.allHasChooseMark=!this.allHasChooseMark},editClick:function(){$(this.$el).find(".ajust").attr("style",""),this.shop.isEditing=!this.shop.isEditing}}}}),define("wap/trade/cart/component/popup_vue",["require","zenjs/events","zenjs/util/number"],function(t){"use strict";function e(t){this.options=t||{},this.component=$.extend({},t.contentViewClass),this.component.methods=this.component.methods||{},this.contentViewOptions=t.contentViewOptions,this.animationTime=this.options.animationTime||300,this.bgAnimationTime=this.options.bgAnimationTime||200,this.isCanNotHide=this.options.isCanNotHide,this.doNotRemoveOnHide=this.options.doNotRemoveOnHide||!1,this.onShow=this.options.onShow||n,this.onHide=this.options.onHide||n,this.onFinishHide=this.options.onFinishHide||n,this._window=$(window),this.render()}var n=function(){},i=(t("zenjs/events"),t("zenjs/util/number"));return window.zenjs=window.zenjs||{},e.prototype.render=function(){var t=this,e=i.makeRandomString();$("body").append('<div id="'+e+'" style="display:none; "></div>');var o=_.keys(this.contentViewOptions),s={};_.each(o,function(e){"function"==typeof t.contentViewOptions[e]?t.component.methods[e]=t.contentViewOptions[e]:s[e]=t.contentViewOptions[e]});var a=this.component.data||n;this.component.data=function(){return _.extend(s,a())},this.component.methods.hideAndClose=function(){t.hide(function(){t.destroy()})};var r=i.makeRandomString();$("body").append('<div id="'+r+'" style="display:none;">                 <div id="vue'+r+'">                    <pp-component ></pp-component>                </div>              </div>'),this.vm=new Vue({el:"#vue"+r,components:{"pp-component":this.component},data:this.contentViewOptions}),this.nBg=$("#"+e),this.nBg.css({height:"100%",position:"fixed",top:0,left:0,right:0,"background-color":"black","z-index":1e3,opacity:0,transition:"opacity ease "+this.bgAnimationTime+"ms","-webkit-transition":"opacity ease "+this.bgAnimationTime+"ms"}),this.nPopContainer=$("#"+r),this.nPopContainer.addClass(this.options.className||""),this.nPopContainer.css(_.extend({left:0,right:0,bottom:0,background:"white",position:"fixed","z-index":1e3,overflow:"hidden",transform:"translate3d(0,100%,0)","-webkit-transform":"translate3d(0,100%,0)","-webkit-transition":"all ease "+this.animationTime+"ms",transition:"all ease "+this.animationTime+"ms"},this.options.containerCss||{}))},e.prototype.show=function(){var t=this;return this.nBg.on("click",function(){t.isCanNotHide||t.hide(function(){t.destroy()})}),this.nBg.css({display:"block"}),this.nPopContainer.css({display:"block"}),setTimeout(function(){t.nBg.css({opacity:"0.7"}),setTimeout(function(){t.top=t._window.scrollTop(),t._window.scrollTop(0),t.bodyCss=($("body").prop("style")||{}).cssText,t.htmlCss=($("html").prop("style")||{}).cssText,$("body,html").css({overflow:"hidden",height:$(window).height()+"px"}),t.nPopContainer.css({transform:"translate3d(0,0,0)","-webkit-transform":"translate3d(0,0,0)"})},200)}),this},e.prototype.hide=function(t){var e=this;$("html").attr("style",e.htmlCss||""),$("body").attr("style",e.bodyCss||""),e.scrollTo(e.top,3),this.nPopContainer.css({transform:"translate3d(0,100%,0)","-webkit-transform":"translate3d(0,100%,0)"}),setTimeout(function(){e.nBg.css({opacity:0}),$("html").attr("style",e.htmlCss||""),$("body").attr("style",e.bodyCss||""),setTimeout(function(){e.nBg.css({display:"none"}),e.nPopContainer.css({display:"none"}),t()},e.bgAnimationTime)},this.animationTime)},e.prototype.destroy=function(){return this.vm.$destroy(),this.nPopContainer.remove(),this.nBg.remove(),this},e.prototype.scrollTo=function(t,e){var n=this,e=e||0;return this._window.scrollTop()==t?this:(this._window.scrollTop(t),0==e?this:(setTimeout(function(){n.scrollTo(t,e-1)},200),this))},e}),define("text!wap/trade/cart/templates/shopListGoPay.html",[],function(){return'<div class="go-pay-shop-list">\n    <h4 class="go-pay-title">请分开结算以下店铺商品</h4>\n    <div class="cancel-img js-cancel" @click="close"></div>\n\n    <div class="shop-list" :style="listStyle">\n\n        <template v-for="(shopState,index) in shopStateList">\n            <div class="shop clearfix">\n                <div class="info">\n                    <p>\n                        <span class="name">{{shopState.name}}</span>\n                    </p>\n                    <p class="price">\n                        <span class="c-gray-darker">共{{shopState.chooseCnt}}件&nbsp;&nbsp;合计:&nbsp;</span>\n                        <span class="c-orange">¥ {{shopState.totalPrice/100}}</span>\n                    </p>\n                </div>\n                <div class="go-pay-btn" @click="submitPay(index)">\n                    去结算\n                </div>\n            </div>\n        </template>\n    </div>\n\n</div>\n'}),define("wap/trade/cart/component/shopListGoPay",["require","text!../templates/shopListGoPay.html"],function(t){"use strict";return{template:t("text!../templates/shopListGoPay.html"),data:function(){return{listStyle:{"max-height":(parseInt(.9*$(window).height()-50,10)||300)+"px","overflow-y":"scroll"}}},methods:{close:function(){this.hideAndClose()},submitPay:function(t){this.hideAndClose(),this.submitPayGoods(this.shopStateList[t].hasChooseMarkGoodsList)}}}}),define("wap/trade/cart/vueApp",["require","wap/trade/cart/api/cartapi","text!./templates/app.html","wap/trade/cart/component/login","wap/trade/cart/component/shop","bower_components/pop/pop_confirm/popout_confirm","wap/trade/cart/component/goods","wap/trade/cart/component/popup_vue","wap/trade/cart/component/shopListGoPay","zenjs/util/local_storage","zenjs/util/args","bower_components/wap_common/base/make_url_log","bower_components/youzanjsbridge/api"],function(t){"use strict";var e=t("wap/trade/cart/api/cartapi"),n=t("text!./templates/app.html"),i=t("wap/trade/cart/component/login"),o=t("wap/trade/cart/component/shop"),s=t("bower_components/pop/pop_confirm/popout_confirm"),a=t("wap/trade/cart/component/goods"),r=t("wap/trade/cart/component/popup_vue"),l=t("wap/trade/cart/component/shopListGoPay"),c=t("zenjs/util/local_storage"),d=t("zenjs/util/args"),u=t("bower_components/wap_common/base/make_url_log"),p=t("bower_components/youzanjsbridge/api"),h=window.vueEventbus=new Vue;Vue.component("vm-app",{template:n,props:["model"],components:{"vm-shop":o,"vm-login":i,"vm-goods":a},computed:{invalidGoodsList:function(){return this.loopResult.invalidGoodsList},shopList:function(){return this.model.shopList},needLogin:function(){return this.model.needLogin},isLogin:function(){return this.model.isLogin},canShowLonginTips:function(){return this.model.canShowLonginTips},loaded:function(){return this.model.loaded},isAppCart:function(){return this.model.isAppCart},shopListHasValidGoods:function(){return this.loopResult.shopHasValidGoodsList},loopResult:function(){var t=0,e=0,n=!0,i=!1,o=[],s=[],a=[],r=[],l=!0,c={};return _.each(this.shopList,function(d){d.isEditing&&(i=!0),d.goods_list.length>0&&s.push(d),a=a.concat(d.unavailable_goods_list);var u={kdtId:d.kdt_id,name:d.store_name||d.title,totalPrice:0,chooseCnt:0,allHasChooseMark:!0,allHasDeleteMark:!0,hasChooseMarkGoodsList:[]};_.each(d.goods_list,function(i){if(i.chooseMark){var s=i.num*i.pay_price;u.totalPrice+=s,u.chooseCnt++,u.hasChooseMarkGoodsList.push(i),t++,e+=s}else u.allHasChooseMark=!1,n=!1;d.isEditing&&(i.deleteMark?o.push(i):u.allHasDeleteMark=!1)}),u.chooseCnt>0&&r.push(u),d.isEditing&&!u.allHasDeleteMark&&(l=!1),c[d.kdt_id]=u}),{chooseCnt:t,totalPrice:e,allHasChooseMark:n,hasEditing:i,hasDeleteMarkGoodsList:o,shopsState:c,shopHasValidGoodsList:s,invalidGoodsList:a,shopStateListHasChoosenGoods:r,allEditingShopHasAllDeleteMark:l}},hasEditing:function(){return this.loopResult.hasEditing},shopsState:function(){return this.loopResult.shopsState},hasDeleteMarkGoodsList:function(){return this.loopResult.hasDeleteMarkGoodsList},allHasChooseMark:{get:function(){return this.loopResult.allHasChooseMark},set:function(t){_.each(this.shopList,function(e){_.each(e.goods_list,function(e){e.chooseMark=t})})}},allEditingShopHasAllDeleteMark:{get:function(){return this.loopResult.allEditingShopHasAllDeleteMark},set:function(t){_.each(this.shopList,function(e){e.isEditing&&_.each(e.goods_list,function(e){e.deleteMark=t})})}},emptyCartLink:function(){return this.model.emptyCartLink}},methods:{deleteGoods:function(t,e,n){for(var i=_.find(this.shopList,function(e){return e.kdt_id===t}),o=i.goods_list.length,s=null,a=0;a<o;a++)if(i.goods_list[a].goods_id==e&&i.goods_list[a].sku_id==n){s=a;break}null!==s&&i.goods_list.splice(s,1);for(var r=(i.unavailable_goods_list||[]).length,l=null,a=0;a<r;a++)if(i.unavailable_goods_list[a].goods_id==e&&i.unavailable_goods_list[a].sku_id==n){l=a;break}null!==l&&i.unavailable_goods_list.splice(l,1),0==i.goods_list.length&&(i.isEditing=!1)},clearInvalidAllGoods:function(){var t=this.invalidGoodsList.length,n=e.deleteBatch(this.invalidGoodsList),i=this;n.done(function(){_.each(i.shopList,function(t){t.unavailable_goods_list.splice(0,t.unavailable_goods_list.length)}),motify.log("成功清空 "+t+" 个失效商品")}),n.fail(function(t){motify.log(t)})},allCheckClick:function(){this.hasEditing?this.allEditingShopHasAllDeleteMark=!this.allEditingShopHasAllDeleteMark:this.allHasChooseMark=!this.allHasChooseMark},deleteAllSelectedGoods:function(){var t=this;s.show("确认将所选 "+this.hasDeleteMarkGoodsList.length+" 个商品删除？",{onOKClicked:function(){var n=e.deleteBatch(t.hasDeleteMarkGoodsList);n.done(function(){_.each(t.hasDeleteMarkGoodsList,function(e){t.deleteGoods(e.kdt_id,e.goods_id,e.sku_id)})}),n.fail(function(t){motify.log(t)})}})},goPayClick:function(){var t=this.loopResult.shopStateListHasChoosenGoods.length;if(!(t<1))return 1==t?void this.submitPayGoods(this.loopResult.shopStateListHasChoosenGoods[0].hasChooseMarkGoodsList):void new r({contentViewClass:l,isCanNotHide:!0,contentViewOptions:{shopStateList:this.loopResult.shopStateListHasChoosenGoods,submitPayGoods:_.bind(this.submitPayGoods,this)},containerCss:{bottom:0,left:0,right:0,background:"white"}}).show()},submitPayGoods:function(t){var n=this,i=e.goToPay(t);i.done(function(e){var i=window._global.url.trade+e.url;i=d.add(i,{showwxpaytitle:1,kdt_id:t[0].kdt_id,book_key:e.key}),i=u(i),n.model.isAppCart?p.gotoWebview({url:i,page:"web"}):location.href=i}),i.fail(function(t){motify.log(t)})},tipsOkClicked:function(){this.model.canShowLonginTips=!1},updatePackageState:function(t){_.each(this.model.shopList,function(e){var n=_.find(t,function(t){return e.kdt_id==t.kdt_id});n&&(e.activity_info=n.activity_info)})}},mounted:function(){var t=this;h.$on("deleteGoods",function(e,n,i){t.deleteGoods(e,n,i)}),h.$on("updatePackageState",function(e){t.updatePackageState(e)})}});var f=new Vue({el:"#cart-container",data:{model:{loaded:!1,shopList:[],needLogin:!1,isLogin:!1,canShowLonginTips:!1,isAppCart:!1,emptyCartLink:""}}}),m=e.getCart(),g="";_global.kdt_id>0&&!e.isMaijiaBan&&"yzapp"!=d.get("source")&&(g=_global.wap_url.wap+"/showcase/homepage?kdt_id="+_global.kdt_id),m.done(function(t){var n=["youzanmars"];_.each(t,function(t){t.isEditing=!1,_.each(t.goods_list,function(n){n.chooseMark=e.isChecked(t.kdt_id,n.goods_id,n.sku_id),n.deleteMark=!1})}),t=_.sortBy(t,function(t){return-t.latest_addcart_timestamp});var i=(new Date).getTime(),o=c.getItem("close_login_tip_time")||0;f.model={shopList:t,needLogin:!window._global.is_third_app&&"youzanwxd"!==_global.platform&&(_global.need_ajax_login||_global.wap_cart_need_ajax_login),isLogin:_global.buyer_id>0,canShowLonginTips:i-o>864e5,loaded:!0,isAppCart:n.indexOf(_global.platform)>-1,emptyCartLink:g},setTimeout(function(){$(".js-lazy").lazyload()},500)}),m.fail(function(t){motify.log(t)})}),require(["wap/trade/cart/vueApp"],function(t){}),define("main",function(){});